[TOC]



在编程中，副作用（side effects）指的是一个函数或表达式在计算结果之外对其环境或程序的状态产生的影响。理解和控制副作用对于确保程序的可预测性、可测试性和可维护性非常重要。以下是一些常见的副作用类型：

### 1. **修改全局状态**
- 改变全局变量或静态变量的值。
- 使用单例模式时修改单例的状态。

### 2. **修改输入参数**
- 改变传入函数的参数对象的属性，特别是当这些参数是引用类型（如对象、数组或指针）时。

### 3. **进行 I/O 操作**
- 读写文件。
- 打印或显示输出。
- 从键盘、网络或其他输入源读取输入。

### 4. **抛出异常**
- 函数内部抛出异常，特别是未经处理直接抛给调用者的异常。

### 5. **修改外部设备状态**
- 更改系统设置或配置。
- 向外部设备发送信号或数据，如打印机、网络路由器等。

### 6. **网络通信**
- 发送或接收网络请求，如 API 调用或数据库操作。

### 7. **使用静态方法**
- 调用静态方法本身通常不是副作用，但如果静态方法修改了静态状态或全局状态，则可以认为是副作用。

### 8. **时间函数**
- 调用依赖于系统时间的函数，如获取当前时间，因为这会使函数的输出依赖于调用时的外部条件。

### 9. **内存或资源操作**
- 分配或释放资源，如内存、文件句柄、数据库连接等。

### 10. **状态机更改**
- 在具有内部状态的对象（如迭代器或生成器）中修改状态。

这些副作用使得函数的行为不仅仅依赖于输入参数，还依赖于外部环境或之前的历史调用，这可能导致程序行为难以预测和理解。在函数式编程中，推荐尽量避免副作用，或将它们隔离管理，以保持代码的纯净和函数的可重用性。



---

函数式编程语言通过一系列核心概念和设计策略来最小化或控制副作用，以提升程序的可预测性、可维护性和可测试性。以下是如何针对上述列出的各种副作用在函数式环境中进行管理：

### 1. **修改全局状态**

**解决方式：**
- 函数式编程鼓励使用不可变数据结构。状态是通过返回新的状态值而不是修改原始状态来更新的，从而避免全局状态修改。
- 使用纯函数，这意味着函数的输出只依赖于输入，不依赖于或改变外部环境。

### 2. **修改输入参数**

**解决方式：**
- 在函数式编程中，输入参数通常被视为不可变的。如果需要修改数据，函数会创建新的数据副本并返回，而不是直接修改输入参数。

### 3. **进行 I/O 操作**

**解决方式：**
- I/O 操作被认为是副作用的典型来源。函数式语言如 Haskell 通过使用 Monads（如 IO Monad）来封装副作用，从而在纯函数的上下文中安全地处理 I/O 操作。
- 使用外部效应系统（如 F# 的 `async` 工作流或 Elm 的命令和订阅模型）来控制副作用，使副作用的操作变得可预测。

### 4. **抛出异常**

**解决方式：**
- 使用 `Either` 或 `Result` 类型来代替异常，显式地表示函数可能失败。这种方式将错误作为返回类型的一部分，使得错误处理更加显式和可控。

### 5. **修改外部设备状态**

**解决方式：**
- 类似于 I/O 操作，对外部设备的任何更改也通过 Monad 或命令模式进行管理，以确保这些操作不会随意分散在代码中。

### 6. **网络通信**

**解决方式：**
- 网络请求和响应被封装在纯函数之外，通常通过类似于 I/O 操作的方式处理，使用特定的异步处理模式或 Monad 来控制这些操作。

### 7. **使用静态方法**

**解决方式：**
- 静态方法如果不涉及全局状态的改变或其他副作用，可以自由使用。如果涉及副作用，则应当封装在 Monad 中或使用类似策略进行隔离。

### 8. **时间函数**

**解决方式：**
- 时间和日期函数在纯函数式编程中通过传递当前时间作为参数或使用专门的时间 Monad 来控制，以避免直接依赖系统时钟的副作用。

### 9. **内存或资源操作**

**解决方式：**
- 函数式编程通过自动垃圾收集来管理内存。对于其他资源，如数据库连接或文件句柄，使用资源管理器模式（如 RAII）或特定的资源 Monad 来确保资源使用后能被正确释放。

### 10. **状态机更改**

**解决方式：**
- 状态变化可以通过函数式响应式编程（FRP）模型来控制，其中状态变更通过纯函数来描述，使用事件流和信号来管理状态变更。

通过这些策略，函数式编程尝试将副作用局限在可控的范围内，或通过纯函数和不可变性来彻底避免副作用，从而使整个程序设计更加清晰和可维护。