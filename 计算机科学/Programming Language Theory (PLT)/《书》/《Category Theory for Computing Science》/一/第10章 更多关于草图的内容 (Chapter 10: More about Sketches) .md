[toc]



好的，让我们继续详细解析**第10章：关于图式的更多内容（More about Sketches）**。本章将深入探讨图式（Sketch）的概念，通过引入有限极限图式（Finite Limit Sketches，简称FL图式）来推广有限积（FP）理论。FL图式允许在描述结构时使用等化子（Equalizers）、拉回（Pullbacks）和其他极限，这使得其表达能力包括了普遍Horn理论（Universal Horn Theories）的能力。最后一节将介绍图式的进一步推广，尽管这些推广在计算机科学中尚未有广泛应用。

## 10 关于图式的更多内容（More about Sketches）

### 10.1 关于图式的进一步讨论（More about Sketches）

**图式（Sketch）** 是范畴论中的一种工具，用于描述代数结构和其他数学对象的特性。图式通过指定一组对象和态射（箭头），以及这些态射之间的关系（如极限和余极限），来定义一个类别中的模型。图式的概念使得我们能够以一种统一和模块化的方式描述复杂的结构。

**有限积图式（Finite Product Sketches，FP图式）** 是图式的一种特例，只涉及有限积。然而，有限积图式的表达能力有限，无法描述更复杂的结构如等化子和拉回。因此，我们需要引入**有限极限图式（Finite Limit Sketches，FL图式）**，它们允许在图式中包含更多类型的极限，从而增强了图式的表达能力。

### 10.2 有限极限图式（Finite Limit Sketches）

**定义**：

**有限极限图式（FL图式）** 是一种图式，它不仅包含有限积，还包含其他类型的有限极限，如等化子和拉回。具体来说，FL图式由以下部分组成：

1. **对象（Objects）**：图式中的节点，表示范畴中的对象。
2. **态射（Arrows）**：图式中的箭头，表示范畴中的态射。
3. **极限图式（Limit Diagrams）**：指定的图式片段，表示需要在模型中实现的极限。

通过包括等化子和拉回，FL图式能够描述更为复杂的代数结构和逻辑关系。例如，等化子允许我们描述代数方程，而拉回则允许我们描述对象之间的相互依赖关系。

**例子1：有限极限图式中的等化子**

考虑两个平行态射$f, g : A \rightrightarrows B $。一个等化子图式可以表示为：

$$
\begin{array}{ccc}
E & \xrightarrow{e} & A \\
\downarrow{f \circ e} & & \downarrow{f} \\
B & \xrightarrow{\text{id}_B} & B \\
\end{array}
$$

在这个图式中，$ E$是$f$和$g$的等化子对象，$ e$是从$E$到$A$的态射，使得$f \circ e = g \circ e $。

### 10.3 FL图式的初始项模型（Initial Term Models of FL Sketches）

**定义**：

**初始项模型（Initial Term Model）** 是满足FL图式中所有关系的最小模型。它通常由自由代数（Free Algebra）构成，其中没有任何额外的等式限制，除了图式中明确规定的那些。

**构造方法**：

1. **生成器（Generators）**：定义模型中基本元素的类型和数量。
2. **运算（Operations）**：定义模型中元素之间的运算规则，如加法、乘法等。
3. **初始项（Terms）**：通过运算生成的表达式，构成模型中的元素。

**例子2：FL图式的初始项模型**

设有一个FL图式$S $，其中包含两个运算$m : A \times A \to S$和$t : C \times C \to A $。初始项模型$F(X)$包含所有通过这些运算生成的术语，如$m(t(u, v), a) $、$ m(a, a)$等。这些术语在模型中形成了一个自由代数，每个元素都有唯一的表达式。

### 10.4 FL图式的理论（The Theory of an FL Sketch）

**定义**：

一个**FL图式的理论**是指由FL图式定义的所有模型所满足的公理和定理的集合。它捕捉了图式中指定的对象、态射以及极限关系所表达的所有性质。

**性质**：

- **一致性（Consistency）**：理论中的公理不应导致矛盾。
- **完备性（Completeness）**：理论应能够导出所有在模型中真实存在的性质。
- **表达能力（Expressiveness）**：FL图式的理论能够描述比FP图式更复杂的结构，如等化子和拉回。

**例子3：FL图式的理论**

继续之前的例子，FL图式$S$定义了运算$m$和$t $，以及它们之间的关系。FL图式的理论包括这些运算的定义、它们的组合规则，以及通过等化子和拉回所引入的额外公理。例如，理论中可能包含$m(t(u, v), a) = m(a, a)$这样的等式。

### 10.5 图式的一般定义（General Definition of Sketch）

**定义**：

**图式（Sketch）** 是一种范畴论工具，用于描述一个类别中的对象和态射之间的结构关系。图式由以下部分组成：

1. **有限图（Finite Diagrams）**：包括对象和态射，表示需要在模型中实现的结构。
2. **极限和余极限**：指定模型中需要满足的极限关系，如积、等化子、拉回等。
3. **运算和公理**：定义对象之间的运算以及需要满足的公理和定理。

**类型**：

- **有限积图式（FP图式）**：仅包含有限积。
- **有限极限图式（FL图式）**：包含有限积以及其他类型的有限极限。
- **一般图式（General Sketch）**：可以包含无限极限和更复杂的结构。

**性质**：

- **自由性（Freeness）**：一个自由图式的模型没有额外的等式限制，除了图式中明确规定的那些。
- **模型的存在性**：图式定义的结构是否在给定的范畴中存在模型。
- **同构性（Isomorphism）**：不同图式可能定义相同的理论，导致同构的模型类别。

**例子4：一般图式**

考虑一个图式$S $，它不仅包含有限积，还包含无限极限，如无限拉回和无限等化子。这样的图式能够描述更加复杂的结构，如无限代数结构和逻辑系统。

### 10.6 练习题（Exercises）

**练习1**：

**题目**：

证明在任何范畴中，如果

$$
\begin{array}{ccc}
A & \rightrightarrows^{f}_{g} & B \\
c \downarrow & & \downarrow \\
C & \xrightarrow{h} & D \\
\end{array}
$$

是一个余等化子图式，且$e : D \to E$是一个上同态（epimorphism），那么

$$
\begin{array}{ccc}
D & \rightrightarrows^{f \circ e}_{g \circ e} & E \\
c \downarrow & & \downarrow \\
C & \xrightarrow{h \circ e} & E \\
\end{array}
$$

也是一个余等化子图式。

**解析**：

**目标**：

证明如果原图式是余等化子，且$e : D \to E$是上同态，那么经过$e$作用后的新图式也是余等化子图式。

**证明步骤**：

1. **设定**：

   - 原图式：
    $$
     \begin{array}{ccc}
     A & \rightrightarrows^{f}_{g} & B \\
     c \downarrow & & \downarrow \\
     C & \xrightarrow{h} & D \\
     \end{array}
    $$
     是一个余等化子图式，满足$h \circ f = h \circ g $。

   - 上同态$e : D \to E $。

2. **构造新图式**：

   - 新图式：
    $$
     \begin{array}{ccc}
     A & \rightrightarrows^{f \circ e}_{g \circ e} & B \\
     c \downarrow & & \downarrow \\
     C & \xrightarrow{h \circ e} & E \\
     \end{array}
    $$
     需要证明这是一个余等化子图式。

3. **验证兼容性条件**：

   - 原条件$h \circ f = h \circ g $，经过$e$的作用，得到：
    $$
     e \circ h \circ f = e \circ h \circ g
    $$
     即：
    $$
     (h \circ e) \circ f = (h \circ e) \circ g
    $$
     因此，新图式满足兼容性条件。

4. **验证普遍性条件**：

   - 假设存在态射$k : B \to F$使得：
    $$
     k \circ (f \circ e) = k \circ (g \circ e)
    $$
     即：
    $$
     k \circ f \circ e = k \circ g \circ e
    $$

   - 由于$e$是上同态，存在唯一态射$l : E \to F$使得：
    $$
     l \circ e = k
    $$

   - 原图式是余等化子，存在唯一态射$m : C \to D$使得：
    $$
     m \circ c = f \quad \text{和} \quad m \circ c = g
    $$

   - 定义态射$m' : C \to E$使得：
    $$
     m' = e \circ m
    $$
     满足：
    $$
     m' \circ c = e \circ m \circ c = e \circ f = f \circ e
    $$
    $$
     m' \circ c = e \circ m \circ c = e \circ g = g \circ e
    $$

   - 由于新图式需要满足$(h \circ e) \circ f = (h \circ e) \circ g $，且$m' \circ c = f \circ e = g \circ e $，根据余等化子的普遍性条件，存在唯一态射$m' : C \to E$使得$m' \circ c = f \circ e$和$m' \circ c = g \circ e $。

5. **结论**：

   因此，新图式也是一个余等化子图式。

**总结**：

通过构造和验证兼容性及普遍性条件，证明了经过上同态作用后的新图式仍然保持余等化子的性质。

---

**练习2**：

**题目**：

在任何具有和的范畴中，如果对于$i = 1, 2 $，态射对：

$$
\begin{array}{ccc}
A_i & \rightrightarrows^{f_i}_{g_i} & B_i \\
c_i \downarrow & & \downarrow \\
C_i & \xrightarrow{h_i} & D_i \\
\end{array}
$$

都是余等化子图式，那么态射对：

$$
\begin{array}{ccc}
A_1 + A_2 & \rightrightarrows^{f_1 + f_2}_{g_1 + g_2} & B_1 + B_2 \\
c_1 + c_2 \downarrow & & \downarrow \\
C_1 + C_2 & \xrightarrow{h_1 + h_2} & D_1 + D_2 \\
\end{array}
$$

也是一个余等化子图式。

**解析**：

**目标**：

证明如果两个平行态射对都是余等化子图式，则它们的和态射对也是余等化子图式。

**证明步骤**：

1. **设定**：

   - 对于$i = 1, 2 $，图式：
    $$
     \begin{array}{ccc}
     A_i & \rightrightarrows^{f_i}_{g_i} & B_i \\
     c_i \downarrow & & \downarrow \\
     C_i & \xrightarrow{h_i} & D_i \\
     \end{array}
    $$
     是余等化子图式。

   - 和态射对：
    $$
     \begin{array}{ccc}
     A_1 + A_2 & \rightrightarrows^{f_1 + f_2}_{g_1 + g_2} & B_1 + B_2 \\
     c_1 + c_2 \downarrow & & \downarrow \\
     C_1 + C_2 & \xrightarrow{h_1 + h_2} & D_1 + D_2 \\
     \end{array}
    $$
     需要证明这是一个余等化子图式。

2. **验证兼容性条件**：

   - 由于每个$h_i \circ f_i = h_i \circ g_i $，因此：
    $$
     (h_1 + h_2) \circ (f_1 + f_2) = h_1 \circ f_1 + h_2 \circ f_2 = h_1 \circ g_1 + h_2 \circ g_2 = (h_1 + h_2) \circ (g_1 + g_2)
    $$
     因此，和态射对满足兼容性条件。

3. **验证普遍性条件**：

   - 假设存在态射$k : B_1 + B_2 \to E$使得：
    $$
     k \circ (f_1 + f_2) = k \circ (g_1 + g_2)
    $$

   - 根据和的定义，存在唯一态射$k_1 : B_1 \to E$和$k_2 : B_2 \to E$使得：
    $$
     k \circ i_1 = k_1 \quad \text{和} \quad k \circ i_2 = k_2
    $$
     其中$i_1 : B_1 \to B_1 + B_2$和$i_2 : B_2 \to B_1 + B_2$是和的规范注射。

   - 由于每个图式都是余等化子，存在唯一态射$l_i : C_i \to D_i$使得：
    $$
     l_i \circ c_i = f_i \quad \text{和} \quad l_i \circ c_i = g_i
    $$

   - 定义态射$l = l_1 + l_2 : C_1 + C_2 \to D_1 + D_2 $，满足：
    $$
     l \circ (c_1 + c_2) = f_1 + f_2 = g_1 + g_2
    $$

   - 由于和态射对满足兼容性条件，存在唯一的态射$m : D_1 + D_2 \to E$使得：
    $$
     m \circ (h_1 + h_2) = k
    $$

4. **结论**：

   因此，和态射对也是余等化子图式。

**总结**：

通过验证兼容性和普遍性条件，证明了如果两个平行态射对都是余等化子图式，那么它们的和态射对也是余等化子图式。这展示了余等化子在和运算下的封闭性。

---

**练习3**：

**题目**：

证明：如果$d_0, d_1 : A_1 + A_2 \to B$是一对平行态射，且$u_i : A_i \to A_1 + A_2$是和的规范注射。如果$e : B \to C$是$d_0 \circ u_1$和$d_1 \circ u_1$的余等化子，且$c : C \to D$是$e \circ d_0 \circ u_2$和$e \circ d_1 \circ u_2$的余等化子，则证明$c \circ e : B \to D$是$d_0$和$d_1$的余等化子。

**解析**：

**目标**：

证明复合态射$c \circ e : B \to D$是$d_0$和$d_1$的余等化子。

**证明步骤**：

1. **设定**：

   -$d_0, d_1 : A_1 + A_2 \to B$是一对平行态射。
   -$u_i : A_i \to A_1 + A_2$是和的规范注射。
   -$e : B \to C$是$d_0 \circ u_1$和$d_1 \circ u_1$的余等化子。
   -$c : C \to D$是$e \circ d_0 \circ u_2$和$e \circ d_1 \circ u_2$的余等化子。

2. **构造余等化子**：

   - 需要证明$c \circ e : B \to D$满足：
    $$
     c \circ e \circ d_0 = c \circ e \circ d_1
    $$
   
   - 由于$e$是$d_0 \circ u_1$和$d_1 \circ u_1$的余等化子，有：
    $$
     e \circ d_0 \circ u_1 = e \circ d_1 \circ u_1
    $$
   
   - 由于$c$是$e \circ d_0 \circ u_2$和$e \circ d_1 \circ u_2$的余等化子，有：
    $$
     c \circ e \circ d_0 \circ u_2 = c \circ e \circ d_1 \circ u_2
    $$

3. **应用普遍性条件**：

   - 由于$e$是余等化子，存在唯一态射$l : C \to E$使得：
    $$
     l \circ e = k
    $$
     其中$k : B \to E$满足$k \circ d_0 = k \circ d_1 $。
   
   - 由于$c$是余等化子，存在唯一态射$m : D \to E$使得：
    $$
     m \circ c = l
    $$
   
   - 因此，$ m \circ c \circ e = l \circ e = k $，满足$k \circ d_0 = k \circ d_1 $。

4. **结论**：

   因此，$ c \circ e : B \to D$满足余等化子的定义，成为$d_0$和$d_1$的余等化子。

**总结**：

通过分步构造和利用已有的余等化子，证明了复合态射$c \circ e$也是一对平行态射$d_0$和$d_1$的余等化子。这展示了余等化子在和运算下的传递性和组合性。

## 本章总结

**图式（Sketch）** 是范畴论中的一个强大工具，用于描述和构造各种数学结构。通过引入**有限极限图式（FL图式）**，我们扩展了图式的表达能力，使其能够描述更复杂的结构，如等化子和拉回。FL图式的初始项模型和其理论为理解代数结构和逻辑系统提供了基础。

**主要要点**：

1. **有限极限图式（FL图式）**：
   - 包含有限积以及其他类型的有限极限，如等化子和拉回。
   - 增强了图式的表达能力，能够描述更复杂的代数结构。

2. **初始项模型**：
   - 是满足FL图式中所有关系的最小模型。
   - 通常由自由代数构成，具有唯一的适当术语表达。

3. **余等化子（Coequalizer）**：
   - 描述统一化（Unification）的范畴论表达。
   - 通过构造余等化子，可以找到最小的统一替换，使得一对平行态射在该替换下相等。

4. **图式的一般定义**：
   - 包含对象、态射及其关系，通过指定极限图式来定义模型。
   - 自由性和同构性确保了模型的唯一性和最小性。

5. **练习题**：
   - 通过具体证明，理解余等化子的性质及其在和运算下的封闭性。
   - 加深对图式构造和模型理论的理解。

**应用与扩展**：

- **自动定理证明**：通过统一化来匹配和合并不同的逻辑表达式。
- **类型推断**：在编程语言中，通过统一化推断变量的类型。
- **范畴论中的逻辑**：统一化作为逻辑中的一个基本操作，可以通过范畴论工具进行分析和推广。
- **程序验证**：利用余等化子的性质确保程序中的条件和操作的一致性。

通过掌握FL图式及其相关概念，读者能够更深入地理解范畴论中的结构构造方法，并将其应用于逻辑、代数和计算机科学中的各种问题，构建更加复杂和精确的数学模型。

### ---------------------------

好的，让我们继续详细解析**第10章：关于图式的更多内容（More about Sketches）**中的**10.1节：有限极限图式（Finite Limit Sketches）**。在上一部分中，我们介绍了有限极限图式的定义、历史背景、符号约定以及一些基本例子。接下来，我们将深入探讨具体的例子，如**简单图的图式**和**范畴的图式**，并解析相关的练习题。

## 10.1 有限极限图式（Finite Limit Sketches）

### 10.1.4 简单图的图式（The Sketch for Simple Graphs）

**定义与背景**：

简单图（Simple Graph）是一种图，其中任意两个节点之间最多只有一条边。为了在范畴论中形式化简单图的定义，我们可以使用有限极限图式（FL图式）来描述其结构和约束条件。

**图式构造**：

1. **基本图式**：

   首先，我们构造一个基本的图式来表示一般图（Graph）的结构。一个一般图包括节点和边，并且有源（source）和目标（target）函数来描述边的连接关系。

   **图式**：
  $$
   \begin{array}{ccc}
   a & \xrightarrow{\text{source}} & \text{source} \\
   \downarrow{\text{target}} & & \downarrow{\text{target}} \\
   b & & \\
   \end{array}
  $$
   其中：
   -$a$表示边（Edge）。
   -$b$表示节点（Vertex）。
   - $\text{source}$ 和 $\text{target}$ 是从边到节点的态射，分别指示边的源和目标。

2. **修改为简单图**：

   为了确保简单图中任意两个节点之间最多有一条边，我们需要在图式中添加额外的限制。这可以通过引入**等化子**和**单态性**（Monomorphism）来实现。

   **步骤**：

   - **引入乘积对象**：

     为了表示两个节点之间的边，我们引入一个乘积对象$n \times n $，其中$n$表示节点的类型。乘积对象允许我们同时考虑两个节点。

   - **添加单态注射态射**：

     定义一个态射$u : a \hookrightarrow n \times n $，表示边的源和目标是特定的节点对。这里，$ u$是单态的，意味着不同的边对应不同的节点对。

   - **添加等化子图式**：

     为了确保同一节点对之间只有一条边，我们添加一个等化子图式，强制在相同节点对上的边被等同。

   **完整图式**：

  $$
   \begin{array}{ccc}
   a \times c \times b & \xrightarrow{u} & n \times n \\
   \downarrow{\text{source}} & & \downarrow{\pi_1} \\
   a & \xrightarrow{\text{source}} & n \\
   \end{array}
   \quad
   \begin{array}{ccc}
   a \times c \times b & \xrightarrow{u} & n \times n \\
   \downarrow{\text{target}} & & \downarrow{\pi_2} \\
   b & \xrightarrow{\text{target}} & n \\
   \end{array}
  $$
   
   其中：
   -$\pi_1$和$\pi_2$是乘积$n \times n$的投影态射。
   - 等化子图式确保对于相同的节点对，只存在一条边。

**效果**：

通过上述图式构造，我们确保了在简单图的模型中：
- 每条边连接两个节点。
- 任意两个节点之间至多有一条边。

**解释**：

- **单态性**确保了不同的边对应不同的节点对，避免了多重边。
- **等化子**用于强制同一节点对上的边被唯一确定，从而实现简单图的性质。

### 10.1.5 范畴的图式（The Sketch for Categories）

**定义与背景**：

在范畴论中，**范畴（Category）**是一种结构，其中包含对象和态射（箭头），并且态射之间满足组合和恒等律。为了在范畴论中形式化范畴的定义，我们可以构造一个有限极限图式（FL图式），其模型即为小范畴。

**图式构造**：

1. **基本节点与态射**：

   图式包含以下节点和态射，用于表示范畴的基本组成部分：
   
   - **节点**：
     -$c_0 $：对象（Objects）。
     -$c_1 $：态射（Morphisms）。
     -$c_2 $：可组合的态射对（Composable Pairs）。
     -$c_3 $：可组合的态射三元组（Composable Triples）。
   
   - **态射**：
     -$u : c_0 \to c_1 $：将对象映射为其恒等态射（Identity Morphism）。
     -$s, t : c_1 \to c_0 $：源（source）和目标（target）函数，分别指示态射的起点和终点。
     -$p_1, p_2, c : c_2 \to c_1 $：用于表示可组合的态射对，其中$c$表示组合态射。
     -$p_1, p_2, p_3 : c_3 \to c_1 $：用于表示可组合的态射三元组。
     - 其他复杂的态射，如$hp1, p2i, hp2, p3i, hp1, ci, hc, p3i : c_3 \to c_2$和$hu \circ t, idi, hid, u \circ si : c_1 \to c_2 $。

2. **添加限制与极限图式**：

   为了确保图式模型满足范畴的定义，我们需要添加一些极限图式（Limit Diagrams）来强制态射之间的组合关系和恒等律。

   **具体图式**：

   - **等化子图式**：

     用于确保态射的组合是唯一的，并且满足范畴的结合律。

   - **乘积图式**：

     用于表示态射的源和目标，以及组合态射的构造。

3. **图式的解释**：

   在集合范畴$\text{Set}$中，图式的模型对应于以下结构：
   
   -$u$被解释为将每个对象映射为其恒等态射。
   -$s$和$t$被解释为态射的源和目标函数。
   -$c$被解释为态射的组合函数。
   - 其他态射用于确保组合的唯一性和满足结合律。

**图式示例**：

下面是一个简化的图式示例，展示如何通过图式构造范畴：

$$
\begin{array}{ccc}
c_1 & \xrightarrow{s} & c_0 \\
\downarrow{t} & & \downarrow{u} \\
c_0 & \xrightarrow{u} & c_1 \\
\end{array}
\quad
\begin{array}{ccc}
c_2 & \xrightarrow{p_1} & c_1 \\
\downarrow{p_2} & & \downarrow{c} \\
c_1 & \xrightarrow{c} & c_2 \\
\end{array}
$$

**解释**：

- **恒等律**：每个对象$c_0$通过$u$映射为其恒等态射。
- **组合律**：通过态射$c$定义态射的组合，确保组合的唯一性和满足结合律。

**模型的性质**：

- **非正则性**：模型的类别（如范畴和函子）不满足正则性，因为它们不满足某些正则范畴的要求（如等化子必须是子集）。
- **同构与正则范畴**：尽管范畴的图式模型不满足正则性，但它们仍然可以通过自由图式和余等化子等构造方法来描述。

**历史背景与相关研究**：

- **Lawvere（1966）**：描述了另一种将范畴定义为图式模型的方法，通过极限保留函子来实现。
- **本图式与Lawvere图式**：两者在描述范畴模型上有相似之处，但侧重点不同。

### 10.1.6 练习题（Exercises）

在这一节中，我们将详细解析**练习1**和**练习2**，帮助加深对有限极限图式（FL图式）及其应用的理解。

#### 练习1：

**题目**：

证明在任何范畴中，如果

$$
\begin{array}{ccc}
A & \rightrightarrows^{f}_{g} & B \\
c \downarrow & & \downarrow \\
C & \xrightarrow{h} & D \\
\end{array}
$$

是一个余等化子图式，且$e : D \to E$是一个上同态（epimorphism），那么

$$
\begin{array}{ccc}
A & \rightrightarrows^{f \circ e}_{g \circ e} & B \\
c \downarrow & & \downarrow \\
C & \xrightarrow{h \circ e} & E \\
\end{array}
$$

也是一个余等化子图式。

**解析**：

**目标**：

证明如果原图式是余等化子，且$e : D \to E$是上同态，那么经过$e$作用后的新图式也是余等化子图式。

**证明步骤**：

1. **设定**：

   - 原图式：
    $$
     \begin{array}{ccc}
     A & \rightrightarrows^{f}_{g} & B \\
     c \downarrow & & \downarrow \\
     C & \xrightarrow{h} & D \\
     \end{array}
    $$
     是一个余等化子图式，满足$h \circ f = h \circ g $。
   
   - 上同态$e : D \to E $。

2. **构造新图式**：

   - 新图式：
    $$
     \begin{array}{ccc}
     A & \rightrightarrows^{f \circ e}_{g \circ e} & B \\
     c \downarrow & & \downarrow \\
     C & \xrightarrow{h \circ e} & E \\
     \end{array}
    $$
     需要证明这是一个余等化子图式。

3. **验证兼容性条件**：

   - 原条件$h \circ f = h \circ g$经过$e$的作用，得到：
    $$
     e \circ h \circ f = e \circ h \circ g
    $$
     即：
    $$
     (h \circ e) \circ f = (h \circ e) \circ g
    $$
     因此，新图式满足兼容性条件。

4. **验证普遍性条件**：

   - **假设**：
     
     假设存在态射$k : B \to F$使得：
    $$
     k \circ (f \circ e) = k \circ (g \circ e)
    $$
     即：
    $$
     k \circ f \circ e = k \circ g \circ e
    $$
   
   - **利用上同态性质**：
     
     由于$e$是上同态，且$e : D \to E$是上同态，因此存在唯一态射$l : E \to F$使得：
    $$
     l \circ e = k
    $$
   
   - **利用原余等化子图式的普遍性**：
     
     原图式是余等化子，满足对于满足$h \circ f = h \circ g$的任意态射，存在唯一态射因式分解。因此，存在唯一态射$m : C \to D$使得：
    $$
     m \circ c = f \quad \text{和} \quad m \circ c = g
    $$
   
   - **构造态射$m' $**：
     
     定义态射$m' : C \to E$使得：
    $$
     m' = e \circ m
    $$
     则：
    $$
     m' \circ c = e \circ m \circ c = e \circ f = f \circ e
    $$
    $$
     m' \circ c = e \circ m \circ c = e \circ g = g \circ e
    $$
   
   - **满足普遍性条件**：
     
     由于新图式需要满足$(h \circ e) \circ f = (h \circ e) \circ g $，且$m' \circ c = f \circ e = g \circ e $，根据余等化子的普遍性条件，存在唯一态射$m' : C \to E$使得$m' \circ c = f \circ e$和$m' \circ c = g \circ e $。

5. **结论**：

   因此，新图式也是一个余等化子图式。

**总结**：

通过构造和验证兼容性及普遍性条件，我们证明了在原图式是余等化子且$e$是上同态的情况下，经过$e$作用后的新图式仍然保持余等化子的性质。

#### 练习2：

**题目**：

在任何具有和的范畴中，如果对于$i = 1, 2 $，态射对：

$$
\begin{array}{ccc}
A_i & \rightrightarrows^{f_i}_{g_i} & B_i \\
c_i \downarrow & & \downarrow \\
C_i & \xrightarrow{h_i} & D_i \\
\end{array}
$$

都是余等化子图式，那么态射对：

$$
\begin{array}{ccc}
A_1 + A_2 & \rightrightarrows^{f_1 + f_2}_{g_1 + g_2} & B_1 + B_2 \\
c_1 + c_2 \downarrow & & \downarrow \\
C_1 + C_2 & \xrightarrow{h_1 + h_2} & D_1 + D_2 \\
\end{array}
$$

也是一个余等化子图式。

**解析**：

**目标**：

证明如果在一个具有和的范畴中，对于$i = 1, 2$的每一对平行态射对都是余等化子图式，那么它们的和态射对也是余等化子图式。

**证明步骤**：

1. **设定**：

   - 对于$i = 1, 2 $，图式：
    $$
     \begin{array}{ccc}
     A_i & \rightrightarrows^{f_i}_{g_i} & B_i \\
     c_i \downarrow & & \downarrow \\
     C_i & \xrightarrow{h_i} & D_i \\
     \end{array}
    $$
     是余等化子图式。

   - 和态射对：
    $$
     \begin{array}{ccc}
     A_1 + A_2 & \rightrightarrows^{f_1 + f_2}_{g_1 + g_2} & B_1 + B_2 \\
     c_1 + c_2 \downarrow & & \downarrow \\
     C_1 + C_2 & \xrightarrow{h_1 + h_2} & D_1 + D_2 \\
     \end{array}
    $$
     需要证明这是一个余等化子图式。

2. **验证兼容性条件**：

   - 由于每个$h_i \circ f_i = h_i \circ g_i $，因此：
    $$
     (h_1 + h_2) \circ (f_1 + f_2) = h_1 \circ f_1 + h_2 \circ f_2 = h_1 \circ g_1 + h_2 \circ g_2 = (h_1 + h_2) \circ (g_1 + g_2)
    $$
     因此，和态射对满足兼容性条件。

3. **验证普遍性条件**：

   - **假设**：
     
     假设存在态射$k : B_1 + B_2 \to E$使得：
    $$
     k \circ (f_1 + f_2) = k \circ (g_1 + g_2)
    $$
   
   - **利用和的投影态射**：
     
     由于$A_1 + A_2$和$B_1 + B_2$是和对象，存在唯一态射$k_1 : B_1 \to E$和$k_2 : B_2 \to E$使得：
    $$
     k \circ i_1 = k_1 \quad \text{和} \quad k \circ i_2 = k_2
    $$
     其中$i_1 : B_1 \to B_1 + B_2$和$i_2 : B_2 \to B_1 + B_2$是和的规范注射。

   - **利用每个余等化子图式的普遍性**：
     
     对于每个$i = 1, 2 $，由于图式：
    $$
     \begin{array}{ccc}
     A_i & \rightrightarrows^{f_i}_{g_i} & B_i \\
     c_i \downarrow & & \downarrow \\
     C_i & \xrightarrow{h_i} & D_i \\
     \end{array}
    $$
     是余等化子图式，因此对于每个$i $，存在唯一态射$l_i : D_i \to E$使得：
    $$
     l_i \circ h_i = k_i
    $$
   
   - **构造态射$l : D_1 + D_2 \to E $**：
     
     定义态射$l = l_1 + l_2 : D_1 + D_2 \to E $，使得：
    $$
     l \circ (h_1 + h_2) = l_1 \circ h_1 + l_2 \circ h_2 = k_1 + k_2 = k
    $$
     因此，态射$l$满足$l \circ (h_1 + h_2) = k $。

4. **结论**：

   - 由于态射$l$是唯一的满足$l \circ (h_1 + h_2) = k$的态射，因此和态射对满足普遍性条件。
   - 因此，和态射对是余等化子图式。

**总结**：

通过验证兼容性条件和普遍性条件，我们证明了在具有和的范畴中，如果每对平行态射对都是余等化子图式，则它们的和态射对也是余等化子图式。这展示了余等化子在和运算下的封闭性，确保了更复杂结构的构造和一致性。

#### 练习3：

**题目**：

证明：如果$d_0, d_1 : A_1 + A_2 \to B$是一对平行态射，且$u_i : A_i \to A_1 + A_2$是和的规范注射。如果$e : B \to C$是$d_0 \circ u_1$和$d_1 \circ u_1$的余等化子，且$c : C \to D$是$e \circ d_0 \circ u_2$和$e \circ d_1 \circ u_2$的余等化子，则证明$c \circ e : B \to D$是$d_0$和$d_1$的余等化子。

**解析**：

**目标**：

证明复合态射$c \circ e : B \to D$是$d_0$和$d_1$的余等化子。

**证明步骤**：

1. **设定**：

   -$d_0, d_1 : A_1 + A_2 \to B$是一对平行态射。
   -$u_i : A_i \to A_1 + A_2$是和的规范注射。
   -$e : B \to C$是$d_0 \circ u_1$和$d_1 \circ u_1$的余等化子。
   -$c : C \to D$是$e \circ d_0 \circ u_2$和$e \circ d_1 \circ u_2$的余等化子。

2. **构造余等化子**：

   - 需要证明$c \circ e : B \to D$满足：
    $$
     c \circ e \circ d_0 = c \circ e \circ d_1
    $$
   
   - 由于$e$是余等化子，满足：
    $$
     e \circ d_0 \circ u_1 = e \circ d_1 \circ u_1
    $$
   
   - 由于$c$是余等化子，满足：
    $$
     c \circ e \circ d_0 \circ u_2 = c \circ e \circ d_1 \circ u_2
    $$
   
3. **验证兼容性条件**：

   - **组合源和目标**：
     
     由于$u_1 : A_1 \to A_1 + A_2$和$u_2 : A_2 \to A_1 + A_2$是和的规范注射，对于任何$a_1 \in A_1$和$a_2 \in A_2 $，有：
    $$
     d_0 \circ u_1(a_1) = d_0(a_1)
    $$
    $$
     d_1 \circ u_1(a_1) = d_1(a_1)
    $$
    $$
     d_0 \circ u_2(a_2) = d_0(a_2)
    $$
    $$
     d_1 \circ u_2(a_2) = d_1(a_2)
    $$
   
   - **应用余等化子性质**：
     
     由于$e$是$d_0 \circ u_1$和$d_1 \circ u_1$的余等化子，对于任意态射$k : C \to E $，若$k \circ e \circ d_0 \circ u_1 = k \circ e \circ d_1 \circ u_1 $，则存在唯一态射$m : D \to E$使得：
    $$
     m \circ c \circ e = k
    $$
   
   - **利用$c$的余等化子性质**：
     
     由于$c$是$e \circ d_0 \circ u_2$和$e \circ d_1 \circ u_2$的余等化子，对于任意态射$n : D \to F $，若$n \circ c \circ e \circ d_0 \circ u_2 = n \circ c \circ e \circ d_1 \circ u_2 $，则存在唯一态射$p : D \to F$使得：
    $$
     p \circ c \circ e = n
    $$
   
4. **构造唯一态射**：

   - **假设存在态射$m : D \to E$使得**：
    $$
     m \circ c \circ e = k
    $$
   
   - **则$m \circ c : C \to E$满足**：
    $$
     (m \circ c) \circ e \circ d_0 = m \circ c \circ e \circ d_0 = m \circ c \circ e \circ d_1
    $$
   
   - **由于$c$是余等化子**，这确保了$m \circ c \circ e$是唯一的。

5. **验证普遍性条件**：

   - **唯一性**：
     
     由于$e$和$c$都是余等化子的复合态射，任何满足$k \circ d_0 = k \circ d_1$的态射$k$都可以通过$c \circ e$唯一地因式分解为$m : D \to E $，使得：
    $$
     m \circ c \circ e = k
    $$
   
   - **存在性**：
     
     因为$e$和$c$是余等化子，且$e$是上同态，所以$c \circ e$满足$(c \circ e) \circ d_0 = (c \circ e) \circ d_1 $，并且对于任何满足$k \circ d_0 = k \circ d_1$的态射$k : B \to E $，存在唯一态射$m : D \to E$使得$m \circ c \circ e = k $。

6. **结论**：

   因此，复合态射$c \circ e : B \to D$满足余等化子的定义，成为$d_0$和$d_1$的余等化子。

**总结**：

通过分步构造和利用已有的余等化子性质，我们证明了复合态射$c \circ e$也是一对平行态射$d_0$和$d_1$的余等化子。这展示了余等化子在和运算下的传递性和组合性，确保了更复杂结构的构造和一致性。

## 本节总结

**有限极限图式（Finite Limit Sketches, FL图式）** 是图式理论中的一个重要概念，它扩展了有限积图式（FP图式）的表达能力，允许在描述结构时使用等化子、拉回等更复杂的有限极限。FL图式能够描述包括普遍Horn理论在内的更复杂的逻辑和代数结构，使其在计算机科学和数学中具有广泛的应用潜力。

**主要要点**：

1. **有限极限图式（FL图式）**：
   - 包含有限积以及其他类型的有限极限，如等化子和拉回。
   - 增强了图式的表达能力，能够描述更复杂的代数结构和逻辑关系。
   
2. **初始项模型（Initial Term Models）**：
   - 是满足FL图式中所有关系的最小模型，通常由自由代数构成。
   - 每个元素都有唯一的适当术语表达，确保了模型的自由性和唯一性。
   
3. **具体例子**：
   - **简单图的图式**：通过引入单态性和等化子，确保任意两个节点之间最多有一条边。
   - **范畴的图式**：构造一个复杂的FL图式，使其模型对应于小范畴，包含对象、态射、恒等态射和组合态射等基本结构。
   
4. **练习题**：
   - 通过具体的证明，理解余等化子的性质及其在和运算下的封闭性。
   - 加深对FL图式构造和模型理论的理解，确保对图式定义和其在范畴论中的应用有深入的掌握。
   

**应用与扩展**：

- **自动定理证明**：利用FL图式中的等化子和拉回，形式化和自动化逻辑表达式的统一化过程。
- **类型推断**：在编程语言理论中，通过FL图式描述类型系统的复杂关系和约束。
- **范畴论中的逻辑**：利用FL图式分析和推广逻辑系统，特别是那些涉及复杂推理规则的系统。
- **程序验证**：利用余等化子和其他极限构造，确保程序在复杂条件和操作下的一致性和正确性。

通过深入理解有限极限图式及其相关概念，读者能够在范畴论的框架下更有效地描述和分析复杂的数学和计算机科学结构，构建更加精确和一致的数学模型。

### ----------------------------

好的，让我们继续详细解析**第10章：关于图式的更多内容（More about Sketches）**中的**10.2节：有限极限图式的初始项模型（Initial Term Models of FL Sketches）**。本节将探讨有限极限图式（Finite Limit Sketches，简称FL图式）的初始项模型的构造方法，并通过**二叉树的图式**这一具体例子，说明FL图式在描述复杂结构中的应用。最后，我们将解析相关的练习题，以加深对FL图式及其初始项模型的理解。

## 10.2 有限极限图式的初始项模型（Initial Term Models of FL Sketches）

### 10.2.1 定义与构造

**有限极限图式（FL图式）**，如前所述，是一种扩展了有限积图式（FP图式）的图式，允许在描述结构时使用更多类型的有限极限，如等化子（Equalizers）和拉回（Pullbacks）。与FP图式类似，FL图式也总是存在初始模型（Initial Models）。在**7.6.5节**中，我们描述了如何为每个有限FP图式构造一个初始项代数（Initial Term Algebra）。对于FL图式，只需对**7.6.5节**中的最后三个规则进行适当修改，即可构造出每个有限FL图式的初始项代数。以下将详细描述这一构造过程。

**修改原因**：

在有限积图式中，锥（cone）的基图式通常是离散的，即没有非平凡的箭头。然而，在FL图式中，锥的基图式可能包含非平凡的箭头（例如，存在从节点$i$指向节点$j$的箭头$u : i \to j $）。因此，模型中的极限对象不仅仅是节点集合的任意元组，而是需要与基图式中的箭头兼容的元组。

**定义**：

设$E : I \to \text{Set}$是一个有限图式（diagram），其中$I$是基图式的形状图（shape graph）。一个**兼容族（Compatible Family）**是一个由$I$的节点索引的元素序列$(x_1, \ldots, x_n) $，满足以下条件：

1. **兼容性条件1（C–1）**：对于每个节点$i $，有$x_i \in E(i) $。
2. **兼容性条件2（C–2）**：对于每个箭头$u : i \to j$在$I$中，满足$E(u)(x_i) = x_j $。

**初始项代数的构造**：

一个**FL图式$S = (G, D, L) $** 的初始项代数是满足以下要求的最小模型：

- **FL–1**：如果$f : a \to b$是图式$G$中的一个箭头，且$[x]$是$I(a)$的一个元素，那么$[f(x)]$是$I(b)$的一个元素，并且$I(f)([x]) = [f(x)] $。
  
- **FL–2**：如果$(f_1, \ldots, f_m)$和$(g_1, \ldots, g_k)$是图式$D$中从节点$a$到节点$b$的两条路径，且$[x] \in I(a) $，则：
 $$
  (I(f_1) \circ I(f_2) \circ \ldots \circ I(f_m))([x]) = (I(g_1) \circ I(g_2) \circ \ldots \circ I(g_k))([x]) \quad \text{在} \ I(b) \ \text{中}
 $$
  
- **FL–3**：如果$D : I \to G$是图式$G$中的一个图式，且$([x_1], \ldots, [x_n])$是$I \circ D$的一个兼容族，且$p : q \to D$是图式$L$中的一个锥（cone），则$[C(x_1, \ldots, x_n)] \in I(q) $。
  
- **FL–4**：如果$p : q \to D$是图式$L$中的一个锥，且$([x_1], \ldots, [x_n])$是$I \circ D$的一个兼容族，使得$[x_i] = [x'_i]$对所有$i = 1, \ldots, n $，则：
 $$
  [C(x_1, \ldots, x_n)] = [C(x'_1, \ldots, x'_n)]
 $$
  
- **FL–5**：如果$p : q \to D$是图式$L$中的一个锥，且$([x_1], \ldots, [x_n])$是$I \circ D$的一个兼容族，则对于所有$i = 1, \ldots, n $，有：
 $$
  [p_i(C(x_1, \ldots, x_n))] = [x_i]
 $$
  
- **FL–6**：如果$p : q \to D$是图式$L$中的一个锥，且$x \in I(q) $，则：
 $$
  [x] = [C(p_1(x), \ldots, p_n(x))]
 $$
  

此外，兼容性条件确保对于任何箭头$u : i \to j$在$I$中，满足：
$$
I(D(u))([x_i]) = [x_j]
$$
从而根据**定理9.3.3**，有：
$$
I(p_i)([C(x_1, \ldots, x_n)]) = [x_i]
$$

### 10.2.2 二叉树的图式（Binary Trees）

**定义与背景**：

二叉树（Binary Tree）是一种数据结构，每个节点最多有两个子节点，通常称为左子节点和右子节点。在计算机科学中，二叉树广泛应用于各种算法和数据存储结构中。为了在范畴论中形式化二叉树的定义，我们可以构造一个有限极限图式（FL图式），其初始项代数即为整数二叉树的集合。

**图式构造**：

1. **基本节点**：

   图式包括以下基本节点：
   
   - **1**：表示空树（Empty Tree）的类型。
   - **t**：表示二叉树（Binary Tree）的类型。
   - **t+**：表示非空二叉树（Nonempty Binary Tree）的类型。
   - **b**：表示布尔代数（Boolean Algebra）的类型。
   - **n**：表示自然数（Natural Numbers）的类型。

2. **运算态射**：

   图式包含以下运算态射：
   
   - **空树相关**：
     -$\text{empty} : 1 \to t$：空树的构造。
     -$\text{empty?} : t \to b$：测试是否为空树。
     -$\text{incl} : t+ \to t$：将非空二叉树包含到二叉树类型中。
   
   - **树的操作**：
     -$\text{val} : t+ \to n$：获取非空二叉树根节点的整数值。
     -$\text{left} : t+ \to t$：获取非空二叉树的左子树。
     -$\text{right} : t+ \to t$：获取非空二叉树的右子树。
   
   - **自然数相关**：
     -$\text{zero} : 1 \to n$：自然数零。
     -$\text{succ} : n \to n$：自然数的后继操作。
   
   - **布尔代数相关**：
     -$\text{true} : 1 \to b$：布尔值真。
     -$\text{and} : b \times b \to b$：布尔与操作。
     -$\text{not} : b \to b$：布尔非操作。

3. **限制与极限图式**：

   为了确保二叉树的结构符合定义，我们需要在图式中添加以下限制：
   
   - **锥（Cone）**：
     
     - **空树的判定**：
       - 构造一个锥，确保在非空二叉树中调用$\text{empty?}$函数返回假（false）。
   
   - **等化子（Equalizers）**：
     
     - 确保对于任何非空二叉树，通过$\text{incl}$函数包含的树在图式模型中保持唯一性。

**图式示意**：

由于文本格式限制，无法直接绘制图式，但可以描述关键关系：

- **空树**：
 $$
  \text{empty} : 1 \to t
 $$
 $$
  \text{empty?} : t \to b
 $$
 $$
  \text{empty?} \circ \text{empty} = \text{false} : 1 \to b
 $$
  
- **非空树包含**：
 $$
  \text{incl} : t+ \to t
 $$
  
- **非空树操作**：
 $$
  \text{val} : t+ \to n
 $$
 $$
  \text{left} : t+ \to t
 $$
 $$
  \text{right} : t+ \to t
 $$
  
- **自然数和布尔代数操作**：
 $$
  \text{zero} : 1 \to n
 $$
 $$
  \text{succ} : n \to n
 $$
 $$
  \text{true} : 1 \to b
 $$
 $$
  \text{and} : b \times b \to b
 $$
 $$
  \text{not} : b \to b
 $$
  
- **约束条件**：
  - 每个非空二叉树都有唯一的根值、左子树和右子树。
  -$\text{empty?}$在非空二叉树上返回假。

**解释**：

通过上述图式构造，我们确保了：

- **唯一性**：每个非空二叉树通过$\text{incl}$函数包含到二叉树类型中，避免了多重包含。
- **结构性**：每个非空二叉树都有唯一的根值、左子树和右子树。
- **操作的正确性**：布尔运算和自然数运算在模型中正确实现。

### 10.2.3 练习题（Exercise）

**练习1**：

**题目**：

在二叉树的图式中，证明对于任何模型$M $，$ M(\text{incl})$是一个单射函数（injective）。提示：使用图式（10.1）。

**解析**：

**目标**：

证明在二叉树的图式模型中，包含函数$\text{incl} : t+ \to t$在模型$M$下的解释$M(\text{incl})$是一个单射函数。即，对于任意两个不同的非空二叉树$T_1, T_2 \in M(t+) $，有：
$$
M(\text{incl})(T_1) \neq M(\text{incl})(T_2)
$$

**证明步骤**：

1. **设定与定义**：

   - **模型$M $**：是二叉树图式的一个模型，即一个满足图式所有约束的代数结构。
   - **包含函数$\text{incl} $**：在模型$M$中，$ M(\text{incl}) : M(t+) \to M(t)$将非空二叉树包含到二叉树类型中。
   
2. **利用图式中的约束条件**：

   根据图式中的构造，尤其是**锥（Cone）10.1**，我们有以下关系：
  $$
   \text{incl} : t+ \to t
  $$
   并且在图式模型中，存在一个锥，确保：
  $$
   M(\text{empty?}) \circ M(\text{incl}) = \text{false}
  $$
   即：
  $$
   M(\text{empty?})(M(\text{incl})(T)) = \text{false} \quad \forall T \in M(t+)
  $$
   
3. **假设反证法**：

   假设$M(\text{incl})$不是单射函数，即存在$T_1, T_2 \in M(t+) $，且$T_1 \neq T_2 $，但：
  $$
   M(\text{incl})(T_1) = M(\text{incl})(T_2)
  $$
   
4. **利用唯一性与构造**：

   - 由于$T_1$和$T_2$是不同的非空二叉树，它们至少在某一部分（如根值、左子树或右子树）存在不同。
   
   - 观察图式中的运算，如$\text{val} : t+ \to n $、$ \text{left} : t+ \to t $、$ \text{right} : t+ \to t $，这些运算在模型中应保持结构上的唯一性。
   
   - 假设$M(\text{incl})(T_1) = M(\text{incl})(T_2) $，那么在模型$M(t)$中，这两个不同的非空二叉树被映射到了同一个二叉树。这将导致模型中存在两个不同的非空二叉树在二叉树类型中被认定为相同。

5. **利用图式中的约束矛盾**：

   - 根据图式中的约束，特别是通过$\text{empty?}$的测试和$\text{incl}$的单态性，模型应确保不同的非空二叉树在包含后仍然是不同的。
   
   - 如果$M(\text{incl})(T_1) = M(\text{incl})(T_2) $，则对于任意的$\text{val} $、$ \text{left} $、$ \text{right}$操作，它们在$M(t)$中的结果也必须相同。然而，这与$T_1 \neq T_2$的假设相矛盾，因为$T_1$和$T_2$至少在某一部分有不同的值或子树。

6. **结论**：

   因此，假设$M(\text{incl})$不是单射函数导致了矛盾，故$M(\text{incl})$必须是单射函数。

**总结**：

通过假设$M(\text{incl})$不是单射并引发矛盾，我们证明了在二叉树的图式模型中，包含函数$\text{incl}$在任何模型$M$下都是单射函数。这确保了非空二叉树在包含到二叉树类型后仍然保持其唯一性和区别性。

## 本节总结

**有限极限图式（FL图式）** 扩展了有限积图式（FP图式）的表达能力，通过引入更多类型的有限极限（如等化子和拉回），能够描述更为复杂和精细的结构。FL图式不仅能够表达普遍Horn理论的内容，还具备更强的表达能力，能够描述如小范畴和函子等复杂结构。通过构造初始项模型，我们能够生成满足图式所有约束的最小模型，这对于理解和应用图式理论具有重要意义。

**主要要点**：

1. **有限极限图式（FL图式）**：
   - 包含有限积以及其他类型的有限极限，如等化子和拉回。
   - 允许描述更复杂的代数结构和逻辑关系。
   
2. **初始项模型（Initial Term Models）**：
   - 是满足FL图式中所有关系的最小模型。
   - 通常由自由代数构成，具有唯一的适当术语表达，确保了模型的自由性和唯一性。
   
3. **具体例子**：
   - **二叉树的图式**：通过引入单态性和等化子，确保任意两个节点之间最多有一条边，并且非空二叉树的结构唯一性。
   
4. **练习题**：
   - 通过具体证明，理解余等化子的性质及其在和运算下的封闭性。
   - 加深对FL图式构造和模型理论的理解，确保对图式定义和其在范畴论中的应用有深入的掌握。
   

**应用与扩展**：

- **自动定理证明**：利用FL图式中的等化子和拉回，形式化和自动化逻辑表达式的统一化过程。
- **类型推断**：在编程语言理论中，通过FL图式描述类型系统的复杂关系和约束。
- **范畴论中的逻辑**：利用FL图式分析和推广逻辑系统，特别是那些涉及复杂推理规则的系统。
- **程序验证**：利用余等化子和其他极限构造，确保程序在复杂条件和操作下的一致性和正确性。

通过深入理解有限极限图式及其初始项模型，读者能够在范畴论的框架下更有效地描述和分析复杂的数学和计算机科学结构，构建更加精确和一致的数学模型。

### ---------------------------

好的，让我们继续详细解析**第10章：关于图式的更多内容（More about Sketches）**中的**10.3节：FL图式的理论（The Theory of an FL Sketch）**。本节将探讨FL图式生成的理论，具体包括一个关键定理、具体例子以及相关练习题的解析。通过这些内容，您将深入理解FL图式在范畴论中的应用及其生成理论的结构。

## 10.3 FL图式的理论（The Theory of an FL Sketch）

### 10.3.1 定理（Theorem）

**定理10.3.1**：

> **给定任意FL图式$S $**，存在一个具有有限极限的范畴$\text{ThFL}(S) $，以及一个模型$M_0 : S \to \text{ThFL}(S) $，满足以下条件：
>
> 1. 对于任何在具有有限极限的范畴$\mathcal{E}$中的模型$M : S \to \mathcal{E} $，存在一个保有限极限的函子$F : \text{ThFL}(S) \to \mathcal{E} $，使得：
>    -$F \circ M_0 = M $；
>    - 如果$F' : \text{ThFL}(S) \to \mathcal{E}$是另一个保有限极限的函子，且$F' \circ M_0 = M $，那么$F$和$F'$是自然同构的。
>
> **$ \text{ThFL}(S) $** 的定义具有以下等价性质：
>
> - **FLT–1**：$ \text{ThFL}(S)$具有所有有限极限。
> - **FLT–2**：模型$M_0$将图式$S$中的每个图式映射为$\text{ThFL}(S)$中的可交换图式。
> - **FLT–3**：模型$M_0$将图式$S$中的每个锥映射为$\text{ThFL}(S)$中的极限锥。
> - **FLT–4**：在$\text{ThFL}(S)$中，任何包含$M_0$图像且满足 **FLT–1**、**FLT–2** 和 **FLT–3** 的子范畴必须等价于整个$\text{ThFL}(S)$。

**解释**：

- **FL图式（Finite Limit Sketch）**：一种图式，包含有限个极限（如积、等化子、拉回等）。
- **初始模型（Initial Model）**：满足图式所有约束的最小模型。
- **$ \text{ThFL}(S) $**：由FL图式$S$生成的理论范畴，具有有限极限，并且包含一个普遍模型$M_0 $。

**意义**：

- 该定理表明，FL图式$S$生成的理论范畴$\text{ThFL}(S)$是一个具有有限极限的范畴，且任何在其他具有有限极限的范畴中的模型都可以通过一个唯一的（至自然同构）保有限极限的函子从$\text{ThFL}(S)$映射而来。
- 这提供了一种通用的方法，将FL图式描述的结构转化为具体的范畴，并确保了理论范畴的普遍性质。

**参考**：

- [Barr and Wells, 1985], Section 4.4, Theorem 2
- [Ehresmann, 1968] 和 [Bastiani and Ehresmann, 1972]：更一般的构造方法，允许无限图式的极限。

### 10.3.2 例子（Examples）

#### 示例1：半群的图式（The Sketch for Semigroups）

**背景**：

在7.2节中，我们介绍了半群的有限积图式（FP图式）。这里，我们讨论它作为FL图式的一个例子。

**图式描述**：

- **基本节点与态射**：
  -$s $：半群的乘法运算。
  -$c $：半群的结合律。
  
- **图式中的限制**：
  - 通过等化子图式强制半群的结合律，即对于所有元素$x, y, z $：
   $$
    (xy)z = x(yz)
   $$
    

**初始项代数**：

- **初始模型$\text{ThFL}(S) $**：构造出的半群初始模型包含所有通过半群运算生成的术语。
  
- **具体解释**：
  - 图式中的节点$v$是等化子图式的极限对象，表示半群中的**幂等元（idempotents）**。具体地，在模型$M$中：
   $$
    M(v) = \{ e \in M(s) \mid ee = e \}
   $$
  - 注意：幂等元集合$M(v)$通常不是子半群。

**意义**：

- 该例子展示了如何通过FL图式定义代数结构，并通过等化子来指定额外的代数性质（如半群的结合律）。
- 初始项代数包含了所有满足半群性质的元素，并通过等化子确保了结合律的满足。

#### 示例2：范畴的图式（The Sketch for Categories）

**背景**：

在10.1.5节中，我们介绍了一个FL图式，其模型在集合范畴中对应于小范畴，态射对应于函子。以下详细描述该图式及其模型的解释。

**图式描述**：

- **基本节点**：
  -$c_0 $：对象（Objects）。
  -$c_1 $：态射（Morphisms）。
  -$c_2 $：可组合的态射对（Composable Pairs）。
  -$c_3 $：可组合的态射三元组（Composable Triples）。
  
- **态射**：
  -$u : c_0 \to c_1 $：每个对象映射到其恒等态射。
  -$s, t : c_1 \to c_0 $：源（source）和目标（target）函数，指示态射的起点和终点。
  -$p_1, p_2, c : c_2 \to c_1 $：表示可组合的态射对，其中$c$表示组合态射。
  -$p_1, p_2, p_3 : c_3 \to c_1 $：表示可组合的态射三元组。
  - 其他态射如$hp1, p2i, hp2, p3i, hp1, ci, hc, p3i : c_3 \to c_2$和$hu \circ t, idi, hid, u \circ si : c_1 \to c_2$用于确保组合的唯一性和一致性。
  
- **极限图式**：
  - 图式中包含若干锥（cones），确保$c_2$和$c_3$被解释为可组合的态射对和三元组。
  

**模型解释**：

- **$ u $**：将每个对象映射为其恒等态射。
- **$ s, t $**：分别表示态射的源和目标函数。
- **$ c $**：态射的组合函数，确保组合的唯一性和满足结合律。
- **极限对象**：
  - **$ c_2 $**：可组合的态射对，即两个态射的源和目标匹配。
  - **$ c_3 $**：可组合的态射三元组，用于验证结合律。

**模型性质**：

- **非正则性**：在集合范畴中，范畴和函子的范畴不满足正则范畴的要求，因为等化子不一定是子集。
- **唯一性与结合律**：通过锥和极限图式，确保组合运算满足范畴的结合律。

**历史背景**：

- **Lawvere（1966）**：描述了另一种通过极限保留函子来定义范畴的方法，与本图式方法密切相关，但侧重点不同。
- **同构性**：不同的图式方法可以生成同样的理论范畴，确保了理论的稳健性和一致性。

**意义**：

- 通过FL图式定义范畴，使得范畴论的基本结构可以在范畴论内部进行形式化描述。
- 确保了模型在任何具有有限极限的范畴中都能正确解释，增强了理论的通用性。

### 10.3.3 练习题（Exercises）

**练习1**：

> **题目**：
>
> 以下图式在范畴的图式中具有一个极限对象$v $。在该图式的FL理论中，这个极限对象在模型中的值是什么？
>
>$$
> \begin{array}{ccc}
> c_1 & & c_0 \\
> \downarrow{s} & & \downarrow{s} \\
> c_1 & \xrightarrow{id} & c_0 \\
> \end{array}
>$$
>
> 图式表示：
>
>$$
> c_1 \xrightarrow{s} c_0
>$$
>$$
> c_1 \xrightarrow{id} c_0
>$$

**解析**：

**目标**：

确定极限对象$v$在任何模型$M$中的值$M(v) $。

**步骤**：

1. **理解图式**：

   该图式描述了两个平行的态射$s, id : c_1 \to c_0 $。我们需要找到它们的等化子（equalizer）。

2. **等化子的定义**：

   在范畴论中，等化子是一个对象$v$及一个态射$e : v \to c_1 $，满足：
  $$
   s \circ e = id \circ e
  $$
   并且对于任何对象$X$及态射$f : X \to c_1$满足$s \circ f = id \circ f $，存在唯一态射$g : X \to v$使得$e \circ g = f $。

3. **在模型中的解释**：

   - **模型$M $**：
     -$M(c_0) $：对象集合。
     -$M(c_1) $：态射集合。
     -$M(s)$和$M(id) $：从态射集合到对象集合的函数。
     
   - **等化子$v $**：
     -$M(v) $：等化子对象，即满足$M(s) \circ M(e) = M(id) \circ M(e)$的态射集合。
     - 即，对于$f \in M(c_1) $，如果$M(s)(f) = M(id)(f) $，则$f \in M(v) $。

4. **具体解释**：

   - **$ M(id) : M(c_1) \to M(c_0) $** 是恒等映射，即$M(id)(f) = f $。
   - 因此，等化子条件为：
    $$
     M(s)(f) = M(id)(f) = f
    $$
     这意味着$f$必须满足$M(s)(f) = f $。

5. **极限对象$v$的值**：

   - **$ M(v) $** 是满足$M(s)(f) = f$的态射集合。
   - 也就是说，$ M(v)$是所有满足$M(s)(f) = f$的态射的子集。

6. **结论**：

   在模型$M$中，极限对象$v$的值$M(v)$是满足$s(f) = f$的所有态射$f \in M(c_1) $。这可以理解为$s$是一个恒等映射的情况下，等化子对象$v$包含了所有在$s$下不变的态射。

**总结**：

在范畴的图式模型中，极限对象$v$在模型$M$中的值$M(v)$是所有满足$s(f) = f$的态射$f \in M(c_1) $。这意味着$v$包含了那些在$s$下保持不变的态射。

---

**练习2**：

> **题目**：
>
> 对于以下图式，类似于练习1，确定其在模型中的极限对象的值：
>
>$$
> \begin{array}{ccc}
> c_2 & \xrightarrow{p_1} & c \\
> \downarrow{p_2} & & \\
> c_1 & & \\
> \end{array}
>$$
>
> 图式表示：
>
>$$
> c_2 \xrightarrow{p_1} c
>$$
>$$
> c_2 \xrightarrow{p_2} c_1
>$$

**解析**：

**目标**：

确定极限对象$v$在该图式中的值$M(v) $（假设该图式被定义为一个等化子或其他类型的极限）。

**步骤**：

1. **理解图式**：

   该图式描述了一个从$c_2$到两个对象$c$和$c_1$的两个态射$p_1$和$p_2 $。我们需要确定这个图式的极限对象$v $。

2. **确定极限类型**：

   根据图式的结构，可能涉及的是拉回（Pullback）或等化子（Equalizer）。假设这是一个拉回图式，即$c_2$是两个态射的拉回。

3. **拉回的定义**：

   在范畴论中，给定两个态射$p_1 : c_2 \to c$和$p_2 : c_2 \to c_1 $，其拉回对象$v$及态射$e_1 : v \to c$和$e_2 : v \to c_1$满足：
  $$
   p_1 \circ e_1 = p_2 \circ e_2
  $$
   并且对于任何对象$X$及态射$f : X \to c$和$g : X \to c_1$满足$p_1 \circ f = p_2 \circ g $，存在唯一态射$h : X \to v$使得：
  $$
   e_1 \circ h = f \quad \text{和} \quad e_2 \circ h = g
  $$

4. **在模型中的解释**：

   - **模型$M $**：
     -$M(c) $、$ M(c_1) $、$ M(c_2) $：对象集合。
     -$M(p_1) : M(c_2) \to M(c)$和$M(p_2) : M(c_2) \to M(c_1)$：态射集合中的函数。
     
   - **拉回对象$v $**：
     -$M(v) $：满足$M(p_1)(e_1(v)) = M(p_2)(e_2(v))$的对象对$(e_1(v), e_2(v))$的集合。
   
5. **具体解释**：

   - **极限对象$v $** 是由所有满足$p_1(f) = p_2(g)$的对象对$(f, g) \in M(c) \times M(c_1)$组成的子集。
   - 即：
    $$
     M(v) = \{ (f, g) \in M(c) \times M(c_1) \mid p_1(f) = p_2(g) \}
    $$
   
6. **结论**：

   在模型$M$中，极限对象$v$的值$M(v)$是满足$M(p_1)(f) = M(p_2)(g)$的所有对象对$(f, g) \in M(c) \times M(c_1) $。

**总结**：

在该图式的模型中，极限对象$v$包含了所有使得$p_1(f) = p_2(g)$的对象对$(f, g) $。这符合拉回的定义，即确保两个态射在某一对象对上的一致性。

---

**练习3**：

> **题目**：
>
> 证明：任何图式$S$的模型$M$同构于一个模型$M_0 $，其满足$M_0(c)$和$M_0(d)$没有共同元素，当且仅当$c \neq d $。

**解析**：

**目标**：

证明任意图式$S$的模型$M$都同构于一个满足$M_0(c)$和$M_0(d)$没有共同元素的模型$M_0 $，前提是$c \neq d $。

**步骤**：

1. **理解题意**：

   - **图式$S $**：一个定义了一系列对象和态射的图式。
   - **模型$M $**：是图式$S$在某个范畴中的解释。
   - **目标**：找到一个模型$M_0 $，其中对于图式中的不同对象$c$和$d $，其在模型中的解释$M_0(c)$和$M_0(d)$没有共同元素。
   
2. **构造模型$M_0 $**：

   - **假设**：图式$S$中对象$c$和$d$不同。
   
   - **目标**：构造一个模型$M_0$同构于$M $，且满足$M_0(c) \cap M_0(d) = \emptyset $。
   
   - **方法**：
     - **重新标记元素**：通过适当的同构映射，将$M(c)$和$M(d)$的元素重新标记，使得它们的集合不重叠。
     - **使用范畴论中的分离方法**：利用范畴论中的工具，如余积（coproducts），将不同对象的解释分离开来。
   
3. **具体证明**：

   - **模型同构的定义**：
     - 两个模型$M$和$M_0$同构，若存在一组态射的自然同构$\phi : M \to M_0 $，即对于图式中的每个对象$c $，有一个同构态射$\phi_c : M(c) \to M_0(c)$使得所有态射$f : c \to d$的解释满足$\phi_d \circ M(f) = M_0(f) \circ \phi_c $。
   
   - **构造$M_0 $**：
     - **定义$M_0 $**：对于图式中的每个对象$c $，定义$M_0(c) = M(c) \times \{c\} $。这样，$ M_0(c)$和$M_0(d)$的元素形式为$(x, c)$和$(y, d) $，确保$M_0(c)$与$M_0(d)$不重叠。
     
     - **定义态射解释**：
       - 对于态射$f : c \to d $，定义$M_0(f) : M_0(c) \to M_0(d)$为：
        $$
         M_0(f)(x, c) = (M(f)(x), d)
        $$
       
     - **定义同构态射$\phi $**：
       - 对于每个对象$c $，定义$\phi_c : M(c) \to M_0(c)$为：
        $$
         \phi_c(x) = (x, c)
        $$
       -$\phi_c$是一个双射，因为它的逆态射$\phi_c^{-1} : M_0(c) \to M(c)$定义为：
        $$
         \phi_c^{-1}(x, c) = x
        $$
     
   - **验证模型同构性**：
     - **态射的兼容性**：
       - 对于任意态射$f : c \to d $，有：
        $$
         \phi_d \circ M(f)(x) = \phi_d(M(f)(x)) = (M(f)(x), d)
        $$
        $$
         M_0(f) \circ \phi_c(x) = M_0(f)(x, c) = (M(f)(x), d)
        $$
         因此，$ \phi_d \circ M(f) = M_0(f) \circ \phi_c $。
       
     - **同构性**：
       -$\phi$是自然同构，因为对于每个对象$c $，$ \phi_c$是双射，并且态射解释满足同构条件。
     
   - **结论**：
   
     因此，模型$M$同构于模型$M_0 $，其中$M_0(c)$和$M_0(d)$没有共同元素，前提是$c \neq d $。

**总结**：

通过构造一个同构模型$M_0 $，将原模型中不同对象的解释通过元组化（tuple）方式分离，确保了$M_0(c)$和$M_0(d)$没有共同元素。这个构造利用了范畴论中的标准同构技术，确保了模型的结构保持不变，同时满足新的不重叠条件。

---

## 本节总结

**FL图式的理论（The Theory of an FL Sketch）** 是范畴论中用于描述和生成复杂数学结构的重要工具。通过FL图式，可以定义具有多种极限的结构，并生成一个具有有限极限的理论范畴$\text{ThFL}(S) $。这一理论范畴具有普遍性质，确保了所有在其他具有有限极限的范畴中的模型都可以唯一地通过保有限极限的函子从$\text{ThFL}(S)$映射而来。

**主要要点**：

1. **FL图式的理论范畴**：
   - FL图式生成的理论范畴$\text{ThFL}(S)$具有所有有限极限。
   -$\text{ThFL}(S)$包含一个普遍模型$M_0 $，确保任何其他模型都可以通过唯一的保有限极限函子与之关联。
   
2. **具体例子**：
   - **半群的图式**：展示了如何通过等化子来定义半群的结合律，并在初始项代数中识别幂等元。
   - **范畴的图式**：通过复杂的图式构造，实现了小范畴和函子的形式化定义，确保了组合和恒等律的满足。
   
3. **练习题的理解与应用**：
   - **练习1** 和 **练习2**：通过具体图式，理解极限对象在模型中的具体含义，如等化子和拉回对象。
   - **练习3**：通过构造同构模型，理解如何在模型中分离不同对象的解释，确保模型的结构一致性。
   
4. **应用与扩展**：
   - **自动定理证明**：利用FL图式中的复杂极限，形式化和自动化逻辑表达式的统一化和推理过程。
   - **类型推断**：在编程语言理论中，FL图式可以描述复杂的类型系统关系，帮助实现类型推断算法。
   - **范畴论中的逻辑分析**：通过FL图式分析逻辑系统的结构，特别是那些涉及复杂推理规则的系统。
   - **程序验证**：利用FL图式的极限构造，确保程序在复杂条件和操作下的一致性和正确性。

**总结**：

FL图式通过引入多种有限极限，增强了图式的表达能力，使其能够描述更为复杂和精细的数学结构。通过理论范畴$\text{ThFL}(S)$的构造和具体例子的分析，展示了FL图式在范畴论和计算机科学中的广泛应用潜力。练习题进一步巩固了对FL图式理论的理解，确保了读者能够在实践中应用这些理论工具。

### ----------------------------

好的，让我们继续详细解析**第10章：关于图式的更多内容（More about Sketches）**中的**10.4节：图式的一般定义（General Definition of Sketch）**。本节将介绍图式的最一般形式，包括其组成部分、模型的定义以及特殊类别的图式（如正则图式）。通过这些内容，您将全面理解图式在范畴论中的广泛应用及其灵活性。

## 10.4 图式的一般定义（General Definition of Sketch）

### 10.4.1 定义（Definition）

**定义10.4.1**：

> **图式（Sketch）**$S = (G, D, L, K)$由以下部分组成：
>
> - **图$G $**：包含一组节点（objects）和态射（arrows）的有向图。
> - **一组图式$D $**：每个图式都是$G$中的一个子图，表示需要在模型中实现的可交换图式（commutative diagrams）。
> - **一组锥$L $**：每个锥都是$G$中的一个锥（cone），表示需要在模型中实现的极限锥（limit cones）。
> - **一组余锥$K $**：每个余锥都是$G$中的一个余锥（cocone），表示需要在模型中实现的余极限余锥（colimit cocones）。

**解释**：

- **图$G $**：图式的基础结构，定义了模型中将要包含的基本对象和态射。
- **图式$D $**：指定了模型中必须满足的可交换性条件。也就是说，在模型中，这些图式对应的态射组合必须是可交换的。
- **锥$L $** 和 **余锥$K $**：分别用于描述模型中需要实现的极限和余极限结构。例如，极限锥可以用于定义产品、等化子等，而余极限余锥可以用于定义余积、余等化子等。

### 10.4.2 模型的定义（Definition of a Model）

**定义10.4.2**：

> **模型（Model）**$M$****：设图式$S = (G, D, L, K)$在范畴$\mathcal{A}$中的一个模型$M$是一个从图$G$到$\mathcal{A}$的基础图的同态（homomorphism），满足以下条件：
>
> 1. **图式$D$中的每个图式被映射为$\mathcal{A}$中的可交换图式**：即$M$使得所有在$D$中指定的图式在$\mathcal{A}$中都是可交换的。
> 2. **图式$L$中的每个锥被映射为$\mathcal{A}$中的极限锥**：即$M$使得所有在$L$中指定的锥在$\mathcal{A}$中都是极限锥。
> 3. **图式$K$中的每个余锥被映射为$\mathcal{A}$中的余极限余锥**：即$M$使得所有在$K$中指定的余锥在$\mathcal{A}$中都是余极限余锥。

**解释**：

- **同态（Homomorphism）**：在这里，模型$M$将图式$G$中的节点和态射映射到范畴$\mathcal{A}$中的对象和态射，保持图式结构的同构性。
- **可交换图式**：在模型中，图式$D$中指定的每个图式必须在$\mathcal{A}$中对应的态射组合是可交换的，即无论如何组合态射，结果相同。
- **极限锥和余极限余锥**：模型必须在$\mathcal{A}$中实现图式$L$和$K$中指定的所有极限和余极限结构。

### 10.4.3 模型之间的态射（Definition of Morphisms Between Models）

**定义10.4.3**：

> **模型之间的态射（Homomorphism of Models）**：设$M, N$是图式$S = (G, D, L, K)$在范畴$\mathcal{A}$中的两个模型。一个模型之间的态射$\alpha : M \to N$是一个自然变换（natural transformation），即对于图式$G$中的每个节点$g $，存在一个态射$\alpha_g : M(g) \to N(g) $，使得对于图式$G$中的每个态射$f : g \to h $，有：
>
>$$
> \alpha_h \circ M(f) = N(f) \circ \alpha_g
>$$
>
> **解释**：
>
> - **自然变换（Natural Transformation）**：在这里，模型之间的态射要求对于图式$G$中的每个态射，模型$M$和模型$N$中对应的态射图式通过$\alpha$保持一致性。
> - **同构性**：如果存在双向的自然变换$\alpha : M \to N$和$\beta : N \to M $，且$\beta \circ \alpha = \text{id}_M$和$\alpha \circ \beta = \text{id}_N $，则$M$和$N$是同构的模型。

### 10.4.4 正则图式（Regular Sketches）

**定义10.4.4**：

> **正则图式（Regular Sketch）**：正则图式是一类特殊的图式，其锥和余锥具有一些共同特性，使得其理论范畴嵌入到一个拓扑图（topos）中，从而继承拓扑图的良好性质。
>
> - **拓扑图（Topos）**：一种具有丰富结构的范畴，类似于集合论的范畴，具有所有小极限和余极限，并且支持逻辑操作。
> - **正则图式的特性**：其锥和余锥的定义方式使得理论范畴$\text{ThReg}(S)$可以嵌入到拓扑图中，确保其具有如逻辑一致性、完整性等良好性质。

**进一步解释**：

- **正则图式的类别**：正则图式包括有限极限图式中的所有结构，但对其锥和余锥有更严格的要求，使得其理论范畴能够嵌入到拓扑图中。
- **特殊类别**：除了正则图式，还有相应的**一致图式（Coherent Sketches）**和**几何图式（Geometric Sketches）**，这些图式对应于不同的逻辑层级和范畴结构。

### 10.4.5 正则余射（Regular Epimorphisms）

**定义10.4.5**：

> **正则余射（Regular Epimorphism）**：在范畴论中，一个态射$f : A \to B$被称为正则余射，如果存在一个余锥图式如下：
>
>$$
> \begin{array}{ccc}
> C & \rightrightarrows^{g}_{h} & A \\
> \downarrow & & \downarrow^{f} \\
> D & \xrightarrow{} & B \\
> \end{array}
>$$
>
> 满足$f \circ g = f \circ h $，且$f$是这个等化子图式的余等化子。

**性质**：

- **正则余射与余积**：正则余射可以看作是某对平行态射的余等化子。
- **范畴中的应用**：正则余射在正则范畴（regular categories）中尤为重要，正则范畴是具有有限极限和正则余射的范畴。
- **图式中的表示**：在有限极限图式中，可以通过特定的余锥图式来表示正则余射。

**解释**：

- **图式语境中的正则余射**：通过在图式中指定特定的余锥，可以在模型中强制某个态射成为正则余射，从而利用范畴的结构性质。
- **保正则余射的函子**：在模型之间的态射（自然变换）中，可以要求它们保正则余射，从而保持结构的完整性。

### 10.4.6 正则图式的定义（Definition of Regular Sketches）

**定义10.4.6**：

> **正则图式（Regular Sketch）**$S = (G, D, L, K)$包含：
>
> - **图$G $**：包含节点和态射的有向图。
> - **图式$D $**：一组$G$中的图式。
> - **锥$L $**：一组$G$中的有限锥。
> - **余锥$K $**：一组$G$中的正则余锥。
>
> **正则余锥的形式**：
>
> - 每个正则余锥的形式为：
>
>$$
> \begin{array}{ccc}
> c & \rightrightarrows^{g}_{h} & a \\
> \downarrow & & \downarrow^{d} \\
> b & & \\
> \end{array}
>$$
>
> - 这里，$ d : a \to b$是一个正则余射，且$c$是$g$和$h$的等化子。

**不理想的特性**：

- **额外的数据**：引入正则图式需要引入额外的节点和态射，如$c$和$d $，这可能导致模型中需要提供这些额外信息。
- **同构态射的复杂性**：自然变换需要保留这些额外的数据，增加了同构态射的复杂性和不必要的信息量。

**解决方法**：

- **添加特定锥**：通过在每个余锥图式中添加一个特定的锥，确保正则余射的定义能够在模型中自动推导，而无需手动指定每个正则余射的生成条件。
- **利用核对偶性质**：通过正则余射的核对偶性质，可以在模型中自动计算并满足正则余射的条件。

**目的**：

- **最小化显式信息**：通过构造方法，尽量减少模型中需要显式提供的信息，确保模型的简洁性和一致性。
- **增强图式的表达能力**：使得正则图式能够在不增加过多复杂性的情况下，描述更为复杂的范畴结构。

### 10.4.7 图式的例子：弱反射图（Weakly Reflexive Graphs）

**示例10.4.7**：

> **弱反射图（Weakly Reflexive Graph）**：一种图，满足每个节点至少有一条自环（loop）。
>
> **构造方法**：
>
> 1. **基础图式**：
>    - 节点：$ n$和$a $。
>    - 态射：$ \text{source} : a \to n$和$\text{target} : a \to n $。
>
> 2. **添加新类型和锥**：
>    - **新类型$r $**：表示自环。
>    - **锥**：
>     $$
>      \begin{array}{ccc}
>      r & \rightrightarrows^{g}_{h} & a \\
>      \downarrow{\text{source}} & & \downarrow{\text{target}} \\
>      n & & \\
>      \end{array}
>     $$
>      - 这个锥表示，态射$g, h : r \to a$需要满足：
>       $$
>        \text{source} \circ g = \text{target} \circ h = \text{source} : r \to n
>       $$
>
> 3. **添加余锥**：
>    - 通过要求$r \to a \to n$是正则余射，确保每个节点至少有一条自环。
>
> **模型解释**：
>
> - **节点$r $** 在模型中被解释为每个节点的自环集合。
> - **正则余射** 确保每个节点至少有一个自环存在。

**效果**：

- **弱反射性**：每个节点至少有一条自环，满足弱反射图的定义。
- **同构态射的无区别**：由于不需要指定特定的自环，所有自环在模型中都是等价的，避免了特定自环的硬性绑定。

**意义**：

- **简化图式**：通过正则图式的构造，简化了弱反射图的描述，避免了复杂的同构条件。
- **自动化条件**：模型中的正则余射条件自动保证了每个节点至少有一个自环，无需手动指定。

### 10.4.8 图式的理论与初始代数（Theories of Sketches and Initial Algebras）

**背景**：

在前面的章节中，我们讨论了有限积图式（FP图式）和有限描述图式（FD图式），并探讨了它们的初始代数和理论。类似地，图式的一般理论也可以通过图式本身的初始代数来构造。

**图式的理论**：

- **图式的模型作为FL理论的模型**：任何图式$S$可以被视为一个FL理论，其模型即为图式的模型。
- **初始代数**：图式的理论可以通过构造其初始代数来实现，这一构造类似于前述的FL图式初始项代数的构造方法。

**理论的构造**：

- **初始代数的普遍性质**：通过初始代数，我们可以生成满足图式所有约束的最小模型。
- **拓扑图中的嵌入**：某些特殊类型的图式（如正则图式、协调图式和几何图式）的理论可以嵌入到拓扑图中，从而利用拓扑图的丰富结构和逻辑性质。

**参考文献**：

- [Barr and Wells, 1985]：详细讨论了图式的理论和各种特殊图式的构造方法。
- [Bagchi and Wells, 1997a]、[Wells, 1990]、[Power and Wells, 1992] 等：探讨了更广泛的图式理论及其应用。

### 10.4.9 定理（Theorems）

**定理10.4.9**：

> **正则图式的理论范畴**：
>
> 设$S$是一个正则图式。存在一个正则范畴$\text{ThReg}(S) $，以及一个模型$M_0 : S \to \text{ThReg}(S) $，满足以下条件：
>
> 1. 对于任何正则范畴$\mathcal{E}$中的模型$M : S \to \mathcal{E} $，存在一个正则函子$F : \text{ThReg}(S) \to \mathcal{E} $，使得：
>    -$F \circ M_0 = M $；
>    - 如果$F' : \text{ThReg}(S) \to \mathcal{E}$是另一个正则函子，满足$F' \circ M_0 = M $，则$F$和$F'$是自然同构的。
>
> **解释**：
>
> - **正则范畴（Regular Category）**：具有有限极限和正则余射的范畴，支持正则逻辑。
> - **理论范畴$\text{ThReg}(S) $**：由正则图式$S$生成的理论范畴，具有所有正则范畴所需的结构。
> - **普遍性质**：理论范畴$\text{ThReg}(S)$作为正则图式$S$的理论，具备普遍性质，确保所有在其他正则范畴中的模型都可以通过唯一的正则函子从$\text{ThReg}(S)$映射而来。

**证明参考**：

- [Barr and Wells, 1985], Proposition 1 of Section 8.2。
- [Bagchi and Wells, 1997a]。

**意义**：

- **理论范畴的构造**：通过正则图式，可以构造出一个理论范畴，作为所有满足图式约束的模型的通用模板。
- **范畴间的关系**：确保任何正则范畴中的模型都可以通过一个唯一的正则函子从理论范畴映射而来，保持结构的一致性和完整性。

### 10.4.10 图式模型的范畴化（Categorization of Sketch Models）

**背景**：

图式模型的范畴可以被描述为可接近范畴（accessible categories）。可接近范畴是范畴论中的一个重要概念，具有良好的结构性质，便于处理大型和复杂的数学结构。

**主要内容**：

- **可接近范畴（Accessible Categories）**：
  - 定义：具有$\kappa $-过滤的对偶有生成集的范畴，其中$\kappa$是一个不可测基数。
  - 特性：具有良好的构造性质，支持各种范畴论工具的应用，如极限、余极限和自由构造。

- **图式模型的范畴化**：
  - **Set-valued Models**：图式在集合范畴中的模型对应于具体的集合及其间的函数映射。
  - **可接近性**：图式模型的范畴可以通过可接近范畴来描述，确保模型范畴的良好结构。

- **相关理论**：
  - **Adámek 和 Rosický (1994)**：在《Locally Presentable and Accessible Categories》中详细讨论了图式模型与可接近范畴之间的关系。
  - **其他参考文献**：[Ehresmann, 1968], [Bastiani and Ehresmann, 1972], [Peake and Peters, 1972], [Kelly, 1982b], [Bagchi and Wells, 1997a] 等。

**解释**：

- **模型范畴的结构**：通过将图式模型的范畴化为可接近范畴，可以利用可接近范畴的结构性质，简化对复杂模型的分析和构造。
- **逻辑与范畴论的结合**：这种范畴化方法将逻辑理论（如图式）与范畴论的结构工具相结合，增强了理论的应用范围和灵活性。

### 10.4.11 图式的推广与应用（Generalizations and Applications of Sketches）

**推广方法**：

- **扩展图式的构造**：
  - **添加新的极限与余极限**：除了有限极限和余极限，可以引入无限极限和余极限，适应更广泛的数学结构需求。
  - **引入新的构造规则**：如正则余射的定义，不需要显式指定其核对偶性质，而是通过图式中的特定锥和余锥来自动推导。

- **示例：弱反射图的图式**：
  - **目标**：定义一个图式，使得每个节点至少有一条自环。
  - **构造方法**：
    1. **基础图式**：定义节点和基本态射。
    2. **添加正则余锥**：确保每个节点至少有一条自环。
    3. **自动化条件**：通过正则图式的定义，使得在模型中自动满足每个节点至少有一条自环，无需显式指定每条自环的具体映射。

**应用示例**：

- **自动定理证明**：通过图式中的极限与余极限构造，形式化逻辑表达式的统一化过程。
- **类型推断**：在编程语言理论中，利用图式描述复杂的类型系统关系，支持类型推断算法的实现。
- **程序验证**：通过图式中的结构条件，确保程序在复杂条件和操作下的一致性和正确性。
- **范畴论中的逻辑分析**：利用图式分析和推广逻辑系统，特别是涉及复杂推理规则的系统。

**进一步推广**：

- **扩展为无限图式**：引入无限极限和余极限，适应更复杂的数学和逻辑结构。
- **引入其他构造**：如依赖极限、幂等余极限等，增强图式的表达能力和灵活性。

**参考文献**：

- [Lair, 1987]
- [Wells, 1990]
- [Power and Wells, 1992]
- [Makkai, 1997]
- [Barr and Wells, 1992]
- [Bagchi and Wells, 1997a]

**总结**：

图式的最一般定义（General Sketch）提供了一种灵活且强大的工具，用于描述和构造各种数学和逻辑结构。通过结合图、图式、锥和余锥，图式能够形式化地定义复杂的范畴结构，并在范畴论中发挥重要作用。特别是正则图式及其理论范畴，为研究和应用提供了坚实的基础，确保了理论的一致性和普遍性。

## 本节总结

**图式的一般定义（General Sketch）** 扩展了前述的有限积图式和有限极限图式的概念，提供了一种更为广泛和灵活的框架，用于描述和构造各种复杂的数学结构和逻辑系统。通过引入图、图式、锥和余锥的组合，图式不仅能够描述对象和态射的基本关系，还能规定模型中需要满足的各种极限和余极限条件。

**主要要点**：

1. **图式的组成**：
   - **图$G $**：基础结构，定义了模型中包含的对象和态射。
   - **图式$D $**：指定了模型中需要满足的可交换图式。
   - **锥$L $** 和 **余锥$K $**：分别用于规定模型中需要实现的极限锥和余极限余锥。

2. **模型的定义**：
   - 模型是从图式$G$到目标范畴$\mathcal{A}$的同态，需保持图式$D$中的可交换性、图式$L$中的极限锥和图式$K$中的余极限余锥。

3. **正则图式**：
   - 一类特殊的图式，其理论范畴嵌入到拓扑图中，确保模型范畴具有良好的逻辑和结构性质。
   - 正则图式通过特定的余锥图式定义正则余射，增强了图式的表达能力和简洁性。

4. **图式理论与初始代数**：
   - 图式生成的理论范畴（如$\text{ThReg}(S) $）具有普遍性质，确保所有模型都可以通过唯一的保有限极限函子从理论范畴映射而来。
   - 初始代数的构造确保了模型的最小性和唯一性，提供了一个通用的框架来分析和构造模型。

5. **图式的推广与应用**：
   - 图式的最一般定义支持无限极限和余极限的构造，适应更复杂的数学和逻辑系统。
   - 图式在自动定理证明、类型推断、程序验证和范畴论中的逻辑分析等领域具有广泛应用。

**应用与扩展**：

- **自动定理证明**：通过图式的极限与余极限构造，形式化和自动化逻辑表达式的统一化和推理过程。
- **类型推断**：在编程语言理论中，利用图式描述复杂的类型系统关系，支持类型推断算法的实现。
- **程序验证**：通过图式中的结构条件，确保程序在复杂条件和操作下的一致性和正确性。
- **范畴论中的逻辑分析**：利用图式分析和推广逻辑系统，特别是涉及复杂推理规则的系统。
- **拓扑图中的图式嵌入**：通过将图式理论嵌入到拓扑图中，利用拓扑图的逻辑和结构性质，增强图式的表达能力和应用范围。

**总结**：

图式的一般定义为范畴论提供了一种高度灵活和强大的工具，用于描述和构造各种复杂的数学和逻辑结构。通过结合图、图式、锥和余锥，图式能够形式化地定义对象和态射之间的关系，并规定模型中需要满足的各种极限和余极限条件。正则图式及其理论范畴的构造方法，确保了图式在研究和应用中的一致性和普遍性。通过深入理解图式的一般定义及其应用，读者能够在范畴论的框架下更有效地描述和分析复杂的数学结构，构建更加精确和一致的数学模型。

### ---------------------------



### ----------------------------



### ---------------------------



### ----------------------------



### ---------------------------



### ----------------------------



### ---------------------------



### ----------------------------