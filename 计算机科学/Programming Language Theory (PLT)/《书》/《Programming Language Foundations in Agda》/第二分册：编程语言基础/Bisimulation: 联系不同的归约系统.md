[toc]

这一章讨论了双向模拟（Bisimulation）的概念，特别是如何在两个不同的归约系统之间建立联系。以下是这一章的详细解释，逐节讲解涉及的概念和公式。

### 模拟与锁步模拟
首先，章节讨论了“模拟”（Simulation）与“锁步模拟”（Lock-step Simulation）的概念。两个系统分别叫做源系统（Source）和目标系统（Target），我们用 $M$ 和 $N$ 表示源系统的项，用 $M^{\dagger}$ 和 $N^{\dagger}$ 表示目标系统的项。

模拟的核心定义是：

$$
M \sim M^{\dagger}
$$

对于任意的 $M$、$M^{\dagger}$ 和 $N$，如果 $M \sim M^{\dagger}$ 并且 $M \rightarrow N$ 成立，那么对于某些 $N^{\dagger}$，$M^{\dagger} \rightarrow^* N^{\dagger}$ 并且 $N \sim N^{\dagger}$ 成立。

在“锁步模拟”中，这一关系更强。具体来说，每一个源系统的归约步骤在目标系统中都存在相应的单个归约步骤，而不是归约序列。

$$
M \rightarrow N \quad \text{且} \quad M \sim M^{\dagger} \implies \exists N^{\dagger}, M^{\dagger} \rightarrow N^{\dagger} \quad \text{且} \quad N \sim N^{\dagger}
$$

### 互模拟（Bisimulation）
互模拟是一种更强的条件，要求两个系统之间的模拟关系是相互的。具体来说，除了源系统模拟目标系统外，目标系统也必须能够模拟源系统。

### 形式化模拟
接下来的部分涉及模拟关系的形式化定义。我们定义一个关系 $\sim$，它表明源系统和目标系统之间的项是如何对应的。该关系的形式化定义如下：

```haskell
data _~_ : ∀ {Γ A} → (Γ ⊢ A) → (Γ ⊢ A) → Set where
  ~` : ∀ {Γ A} {x : Γ ∋ A} -> ` x ~ ` x
  ~ƛ_ : ∀ {Γ A B} {N N† : Γ , A ⊢ B} -> N ~ N† -> ƛ N ~ ƛ N†
  _~·_ : ∀ {Γ A B} {L L† : Γ ⊢ A ⇒ B} {M M† : Γ ⊢ A} -> L ~ L† -> M ~ M† -> L · M ~ L† · M†
  ~let : ∀ {Γ A B} {M M† : Γ ⊢ A} {N N† : Γ , A ⊢ B} -> M ~ M† -> N ~ N† -> `let M N ~ (ƛ N†) · M†
```

### 技术结果：模拟与值、重命名、替换的可交换性

1. **模拟与值的可交换性**：当 $M \sim M^{\dagger}$ 且 $M$ 是一个值时，$M^{\dagger}$ 也是一个值。

```haskell
~val : ∀ {Γ A} {M M† : Γ ⊢ A} -> M ~ M† -> Value M -> Value M†
```

2. **模拟与重命名的可交换性**：如果 $ρ$ 将任意的判断 $Γ ∋ A$ 映射到另一个判断 $Δ ∋ A$，并且 $M \sim M^{\dagger}$，那么重命名 $ρ$ 在两者上都成立。

```haskell
~rename : ∀ {Γ Δ} -> (ρ : ∀ {A} → Γ ∋ A → Δ ∋ A) -> (∀ {A} {M M† : Γ ⊢ A} -> M ~ M† -> rename ρ M ~ rename ρ M†)
```

3. **模拟与替换的可交换性**：如果 $σ$ 和 $σ^{\dagger}$ 都将任何判断 $Γ ∋ A$ 映射到 $Δ ⊢ A$，并且 $M \sim M^{\dagger}$，那么替换后的项 $subst σ M$ 和 $subst σ† M†$ 也相互模拟。

```haskell
~subst : ∀ {Γ Δ} -> {σ : ∀ {A} → Γ ∋ A → Δ ⊢ A} -> {σ† : ∀ {A} → Γ ∋ A → Δ ⊢ A} -> (∀ {A} → (x : Γ ∋ A) → σ x ~ σ† x) -> (∀ {A} {M M† : Γ ⊢ A} -> M ~ M† -> subst σ M ~ subst σ† M†)
```

### 锁步模拟的证明
最后，我们证明给定的关系确实是一个锁步模拟。我们形式化了这个模拟的定义，并展示了其满足锁步模拟的条件。

```haskell
sim : ∀ {Γ A} {M M† N : Γ ⊢ A} -> M ~ M† -> M —→ N -> Leg  M† N
```

证明的结构与之前在“可进性”部分看到的类似，分为多种情况进行处理，确保所有的可能性都被覆盖。

### 练习与证明
章节末尾提供了一些练习，要求读者形式化某些关系并证明它们是互模拟的。这些练习有助于加深对模拟和互模拟概念的理解。

这一章在更高层次上解释了如何通过模拟关系来桥接两个不同的归约系统，并展示了如何在形式化语言中精确地定义和证明这些关系。
