[toc]



### **第14章 系统 F 的强规范化**

#### **引言**

本章的目标是证明：

**定理**：系统 F 的所有项都是**强规范化的**（strongly normalisable），并且**正常形**（normal form）是唯一的。

- **强规范化**：每个项经过有限步归约后都会到达一个不能再归约的正常形。

- **正常形唯一性**：每个项的归约过程最终到达的正常形是唯一的。

**唯一性**的问题并不复杂：它来自于 **Church-Rosser 定理**的扩展。

然而，**存在性**要微妙得多。事实上，我们将在第15章看到，系统 F 的规范化定理蕴含了**二阶算术 PA₂ 的一致性**。逻辑学中经典的结果（如果有什么配得上这个称号的话）是 **G\"odel 的第二不完备性定理**，它表明（假设其不矛盾）PA₂ 的一致性无法在 PA₂ 内部证明。

因此，由于一致性可以从 PA₂ 内的规范化推导出来，那么规范化定理就不能在 PA₂ 内部证明。这为我们的证明提供了一个重要的信息：我们必须寻找一个**超出 PA₂** 的策略。

基本上，PA₂ 包含了**理解公理（schema of comprehension）**：

$$
\exists X.\ \forall \xi.\ (\xi \in X \Leftrightarrow A[\xi])
$$

其中 $A$ 是一个公式，变量 $X$ 在其中不自由出现。$A$ 可以包含一阶（$\forall \xi$，$\exists \xi$）和二阶（$\forall X$，$\exists X$）的量化。直观上，一阶变量范围在整数上，二阶变量范围在整数的集合上。这个系统足以用于日常数学：例如，实数可以编码为整数的集合。

因此，我们希望使用“所有可能”的理解公理，或者至少是其中的一大类。为此，我们将回顾 **Tait** 的证明（使用可约性），并尝试将其扩展到系统 F。

---

### **14.1 证明的思路**

我们想要说，类型为 $\Pi X. T$ 的项 $t$ 是**可约的**（reducible），当且仅当对于所有类型 $U$，$t\ U$ 是可约的，类型为 $T[U/X]$。例如，$t$ 类型为 $\Pi X. X$ 时，$t$ 是可约的，当且仅当对于所有 $U$，$t\ U$ 是可约的。

但是，$U$ 是任意的——它可能是 $\Pi X. X$。在我们定义可约性之前，我们需要知道类型 $U$ 的可约性的含义！这样我们永远无法取得进展。此外，如果这种方法是可行的，它也适用于规范化失败的系统 F 的变体。

#### **14.1.1 可约性候选（Reducibility Candidates）**

为了解决这个问题，我们将引入**可约性候选**。类型 $U$ 的可约性候选是一个任意的可约性谓词（即 $U$ 类型的项的集合），满足第6章中（CR 1-3）条件。

在所有的“候选”中，可以找到类型 $U$ 的“真正的”可约性谓词。

- **定义**：当且仅当对于所有类型 $U$ 和 $U$ 类型的可约性候选 $R$，$t\ U$ 是可约的，类型为 $T[U/X]$，其中这个可约性是使用 $R$ 来定义的。

当然，如果 $R$ 是类型 $U$ 的“真正的”可约性，那么我们用于 $T[U/X]$ 的定义也将是“真正的”。换句话说，一切都像是全称抽象（universal abstraction）规则（它形成了对任意类型定义的函数）是如此的统一，以至于它在没有关于其参数的任何信息的情况下运作。

**举例**：让我们非正式地看一下全称恒等函数 $\Lambda X.\ \lambda x^X.\ x$ 如何是可约的。它的类型是 $\Pi X.\ X \to X$，当且仅当对于所有类型 $U$ 和 $U$ 类型的可约性候选 $R$，$t\ U$ 是可约的，类型为 $U \to U$，这个可约性是通过 $R$ 定义的。

现在，$t\ U$ 类型为 $U \to U$，它是可约的，当且仅当对于所有类型为 $U$ 的可约项 $u$（即 $u \in R$），$t\ U\ u$ 是类型为 $U$ 的可约项（即 $t\ U\ u \in R$）。我们需要证明 $u \in R \Rightarrow t\ U\ u \in R$；但 $R$ 满足（CR 1-3），并且 $t\ U\ u$ 是**中性项**（neutral term），因此这个蕴含可以通过使用（CR 3）来得到。

#### **14.1.2 备注**

（CR 1-3）的选择是至关重要的。我们需要在一个任意的项集上识别一些有用的归纳假设，并且它们必须通过构造“真正的可约性”来保持。

这些条件最初是通过反复试验发现的。在**线性逻辑**中，可约性候选以更自然的方式出现，源自项上的正交性（orthogonality）的概念 [Girard87]。

对于全称类型 $\Pi X.\ V$，引入了对项集的量化（实际上是对所有可约性候选的量化）。因此，我们对可约性进行了越来越复杂的定义，没有二阶公式 $\text{RED}(T, t)$ 能够表达“$t$ 是类型 $T$ 的可约项”。这与在一阶系统（如系统 T）中发生的情况完全类似。

但关键是，为了解释全称应用方案 $t\ U$，我们必须在 $t$ 的可约性定义中，替换的不仅是一个任意的候选，而是我们根据 $U$ 的构造得到的那个。因此，我们必须能够通过一个公式来定义类型 $U$ 的项集，这在本质上使用了理解公理。

对于二阶系统，不像较简单的系统，没有已知的替代证明方法。例如，对于构造理论（Theory of Constructions）[Coquand] 的规范化——一个更强的系统——可以通过对这里介绍的方法进行调整来证明。

---

#### **14.1.3 定义**

**中性项（Neutral Terms）**：一个项 $t$ 是中性的，如果它不以抽象符号开始，即它具有以下形式之一：

- **变量**：$x$

- **应用**：$t\ u$

- **类型应用**：$t\ U$

**可约性候选**：类型 $U$ 的可约性候选是类型为 $U$ 的项的集合 $R$，满足以下条件：

- **(CR 1)**：如果 $t \in R$，那么 $t$ 是**强规范化的**。

- **(CR 2)**：如果 $t \in R$ 且 $t \to t'$，则 $t' \in R$。

- **(CR 3)**：如果 $t$ 是中性的，并且当我们对 $t$ 中的一个红ex（redex）进行归约时，得到 $t' \in R$，那么 $t \in R$。

**注释**：

- 从（CR 3）我们特别有：

  - **(CR 4)**：如果 $t$ 是中性且**正常的**（normal，即无法进一步归约），那么 $t \in R$。

- 这表明 $R$ 永不为空，因为它总是包含类型为 $U$ 的变量。

**举例**：类型 $U$ 的**强规范化项**的集合是一个可约性候选（见 6.2.1）。

---

**函数类型的可约性**：

- 如果 $R$ 和 $S$ 是类型 $U$ 和 $V$ 的可约性候选，那么我们可以定义类型为 $U \to V$ 的项的集合 $R \to S$：

  $$
  t \in R \to S \quad \text{当且仅当} \quad \forall u\ (u \in R \Rightarrow t\ u \in S)
  $$

- 根据 6.2.3，我们知道 $R \to S$ 是类型 $U \to V$ 的可约性候选。

---

### **14.2 带参数的可约性**

设 $T[X]$ 是一个类型，其中我们理解 $X$ 至少包含 $T$ 的所有自由变量。令 $U$ 是一个类型序列，与 $X$ 的长度相同；然后我们可以通过同时替换（substitution）定义类型 $T[U/X]$。

现在，令 $R$ 是对应类型的可约性候选序列；然后我们可以定义集合 $\text{RED}_T [R/X]$（**参数化可约性**），其包含类型为 $T[U/X]$ 的项，定义如下：

1. **基本情况**：如果 $T = X_i$，那么 $\text{RED}_T [R/X] = R_i$。

2. **函数类型**：如果 $T = V \to W$，那么

   $$
   \text{RED}_T [R/X] = \text{RED}_V [R/X] \to \text{RED}_W [R/X]
   $$

3. **全称类型**：如果 $T = \Pi Y.\ W$，那么 $\text{RED}_T [R/X]$ 是类型为 $T[U/X]$ 的项的集合 $t$，满足对于**每个类型 $V$ 和类型 $V$ 的可约性候选 $S$**，都有：

   $$
   t\ V \in \text{RED}_W [R/X,\ S/Y]
   $$

   - **解释**：$t$ 应用于任意类型 $V$ 和其可约性候选 $S$，得到的项 $t\ V$ 属于 $\text{RED}_W [R/X,\ S/Y]$。

---

**引理**：$\text{RED}_T [R/X]$ 是类型 $T[U/X]$ 的可约性候选。

**证明**：对 $T$ 进行归纳；唯一需要考虑的情况是 $T = \Pi Y.\ W$。

- **(CR 1)**：

  - **目标**：证明 $t \in \text{RED}_T [R/X]$，则 $t$ 是强规范化的。

  - **证明**：

    - 取任意类型 $V$ 和其可约性候选 $S$（例如，类型 $V$ 的强规范化项的集合）。

    - 根据定义，$t\ V \in \text{RED}_W [R/X,\ S/Y]$。

    - 根据归纳假设（在 $W$ 上），$t\ V$ 是强规范化的。

    - 由于 $\nu(t) \leq \nu(t\ V)$（项 $t$ 的归约次数不超过 $t\ V$ 的归约次数），因此 $t$ 也是强规范化的。

- **(CR 2)**：

  - **目标**：如果 $t \in \text{RED}_T [R/X]$ 且 $t \to t'$，则 $t' \in \text{RED}_T [R/X]$。

  - **证明**：

    - 对于所有类型 $V$ 和可约性候选 $S$，有 $t\ V \in \text{RED}_W [R/X,\ S/Y]$，且 $t\ V \to t'\ V$。

    - 根据归纳假设，$t'\ V \in \text{RED}_W [R/X,\ S/Y]$。

    - 因此，$t' \in \text{RED}_T [R/X]$。

- **(CR 3)**：

  - **目标**：如果 $t$ 是中性的，且 $t$ 的一步归约 $t'$ 满足 $t' \in \text{RED}_T [R/X]$，则 $t \in \text{RED}_T [R/X]$。

  - **证明**：

    - 取任意 $V$ 和 $S$。

    - 对 $t\ V$ 中的红ex进行归约，由于 $t$ 是中性的，归约的结果是 $t'\ V$。

    - 由于 $t' \in \text{RED}_T [R/X]$，所以 $t'\ V \in \text{RED}_W [R/X,\ S/Y]$。

    - 根据归纳假设（CR 3），$t\ V \in \text{RED}_W [R/X,\ S/Y]$。

    - 因此，$t \in \text{RED}_T [R/X]$。

---

#### **14.2.1 替换**

以下引理说明了参数化可约性在替换方面的良好行为：

**引理**：

$$
\text{RED}_{T[V/Y]} [R/X] = \text{RED}_T [R/X,\ \text{RED}_V [R/X]/Y]
$$

- **解释**：在左边，我们首先用 $V$ 替换 $Y$，然后在类型 $T[V/Y]$ 中计算 $\text{RED}_{T[V/Y]} [R/X]$。

- 在右边，我们在 $\text{RED}_T$ 中，用 $R/X$ 和 $\text{RED}_V [R/X]/Y$ 作为参数。

- **注意**：为了能够将谓词 $\text{RED}_V [R/X]$ 作为参数使用，我们需要利用理解公理，确保它是一个集合。

**证明**：通过对 $T$ 进行直接的归纳。唯一的困难在于精确地表述这个引理。

---

#### **14.2.2 全称抽象**

**引理**：如果对于**每个类型 $V$ 和可约性候选 $S$**，都有 $w[V/Y] \in \text{RED}_W [R/X,\ S/Y]$，那么 $\Lambda Y.\ w \in \text{RED}_{\Pi Y.\ W} [R/X]$。

**证明**：

- **目标**：证明 $\Lambda Y.\ w$ 属于 $\text{RED}_{\Pi Y.\ W} [R/X]$。

- **方法**：我们需要证明对于每个类型 $V$ 和可约性候选 $S$，都有 $(\Lambda Y.\ w)\ V \in \text{RED}_W [R/X,\ S/Y]$。

- **步骤**：

  - **归纳假设**：对 $\nu(w)$ 进行归纳，其中 $\nu(w)$ 是 $w$ 的归约次数。

  - **考虑对 $(\Lambda Y.\ w)\ V$ 进行归约**：

    - **情况1**：归约 $\Lambda Y.\ w$ 内部的红ex，得到 $(\Lambda Y.\ w')\ V$，其中 $\nu(w') < \nu(w)$。

      - 根据归纳假设，$(\Lambda Y.\ w')\ V \in \text{RED}_W [R/X,\ S/Y]$。

    - **情况2**：对 $(\Lambda Y.\ w)\ V$ 应用归约规则，得到 $w[V/Y]$。

      - 根据假设，$w[V/Y] \in \text{RED}_W [R/X,\ S/Y]$。

  - **结论**：由于所有的归约结果都在 $\text{RED}_W [R/X,\ S/Y]$ 中，根据（CR 3），$(\Lambda Y.\ w)\ V \in \text{RED}_W [R/X,\ S/Y]$。

  - 因此，$\Lambda Y.\ w \in \text{RED}_{\Pi Y.\ W} [R/X]$。

---

#### **14.2.3 全称应用**

**引理**：如果 $t \in \text{RED}_{\Pi Y.\ W} [R/X]$，那么对于每个类型 $V$，$t\ V \in \text{RED}_{W[V/Y]} [R/X]$。

**证明**：

- **方法**：

  - 根据假设，对于每个可约性候选 $S$，有 $t\ V \in \text{RED}_W [R/X,\ S/Y]$。

  - 取 $S = \text{RED}_V [R/X]$。

  - 根据之前的引理（14.2.1），$\text{RED}_W [R/X,\ \text{RED}_V [R/X]/Y] = \text{RED}_{W[V/Y]} [R/X]$。

  - 因此，$t\ V \in \text{RED}_{W[V/Y]} [R/X]$。

---

### **14.3 可约性定理**

**定义**：如果项 $t$ 类型为 $T$，并且 $t \in \text{RED}_T [\text{SN}/X]$，则称 $t$ 是**可约的**，其中 $X_1, \dots, X_m$ 是 $T$ 的自由类型变量，$\text{SN}_i$ 是类型 $X_i$ 的强规范化项的集合。

如同在第6章中，我们可以证明：

**定理**：系统 F 的所有项都是可约的。

因此，根据（CR 1），得到：

**推论**：系统 F 的所有项都是**强规范化的**。

---

#### **更一般的结果**

我们需要一个更一般的结果，它在类型和项上都使用了替换，从中可以通过取 $R_i = \text{SN}_i$ 和 $u_j = x_j$ 得到上述定理。

**命题**：

设 $t$ 是类型为 $T$ 的项。假设 $t$ 的所有自由变量都在 $x_1, \dots, x_n$ 中，且它们的类型为 $U_1, \dots, U_n$，并且 $T, U_1, \dots, U_n$ 的所有自由类型变量都在 $X_1, \dots, X_m$ 中。

如果 $R_1, \dots, R_m$ 是类型为 $V_1, \dots, V_m$ 的可约性候选，$u_1, \dots, u_n$ 是类型为 $U_1[V/X], \dots, U_n[V/X]$ 的项，且 $u_j \in \text{RED}_{U_j} [R/X]$，那么

$$
t[V/X][u/x] \in \text{RED}_T [R/X]
$$

**解释**：

- **$t[V/X]$**：在 $t$ 中，用 $V_i$ 替换 $X_i$。

- **$[u/x]$**：在 $t[V/X]$ 中，用 $u_j$ 替换 $x_j$。

- **结论**：替换后的项属于 $\text{RED}_T [R/X]$。

---

#### **证明**

证明类似于 6.3.3。新的情况可以使用 14.2.2 和 14.2.3 处理。

- **步骤**：

  - 对 $t$ 的构造进行归纳，证明替换后的项 $t[V/X][u/x]$ 属于 $\text{RED}_T [R/X]$。

  - **基本情况**：当 $t$ 是变量或常量时，验证结论。

  - **归纳步骤**：对于 $t$ 的不同构造（如应用、抽象、类型抽象、类型应用等），利用归纳假设和之前的引理，证明结论。

  - **特殊情况**：

    - **类型抽象（$\Lambda Y.\ w$）**：使用引理 14.2.2。

    - **类型应用（$t\ V$）**：使用引理 14.2.3。

---

### **总结**

本章通过引入**可约性候选**的概念，证明了系统 F 的所有项都是**强规范化的**，并且**正常形是唯一的**。

- **关键概念**：

  - **可约性候选**：满足特定条件（CR 1-3）的项集合，用于定义可约性。

  - **参数化可约性**：允许在定义可约性时，引入类型和可约性候选的参数。

- **主要引理和结果**：

  - **参数化可约性引理**：证明了可约性候选在替换和类型构造下的良好性质。

  - **全称抽象和应用的可约性**：通过引理 14.2.2 和 14.2.3，处理了系统 F 中全称类型的情况。

  - **可约性定理**：所有系统 F 的项都是可约的，进而是强规范化的。

- **证明方法**：

  - **归纳法**：对项的构造和类型进行归纳，利用可约性候选的性质和之前的引理，逐步证明结论。

  - **超越 PA₂ 的策略**：由于系统 F 的规范化定理不能在 PA₂ 内部证明，因此采用了超出 PA₂ 的方法，引入了复杂的可约性定义和参数。

---

### **后续展望**

- **更强的系统**：对于更强的类型系统（如构造理论），可以考虑类似的方法来证明规范化。

- **可约性候选的深入研究**：在其他逻辑系统和类型系统中，研究可约性候选的概念及其应用。

- **理解公理的应用**：本章的证明依赖于理解公理，表明在高阶逻辑和类型系统中，其重要性。

---

如果您对本章的任何部分有疑问，或者需要更详细的解释，请随时提出来！

### ---------------------------



### ----------------------------



### ---------------------------



### ----------------------------



### ---------------------------



### ----------------------------



### ---------------------------



### ----------------------------



### ---------------------------



### ----------------------------



### ---------------------------



### ----------------------------