[TOC]

### å‰è¨€

æœ€è¿‘ä¸¤å¹´ï¼ŒMVVMçš„å‘¼å£°è¶Šæ¥è¶Šé«˜ï¼Œè¯´å®è¯ï¼Œåœ¨ç»å†äº†MVPçš„è‡ƒè‚¿ï¼ŒMVPçš„ç¹çï¼Œæˆ‘æœ‰ç‚¹æ€•äº†ã€‚ä½†æ˜¯è¿™æ¬¡Googleå®˜æ–¹å¸¦æ¥çš„ä¸€ç³»åˆ—ä¸ºMVVMæ¶æ„è®¾è®¡çš„æ­¦å™¨â€”`Jetpack`ï¼ŒçœŸçš„è®©æˆ‘æƒŠå–œåˆ°äº†ã€‚

ä¹Ÿè®¸ä½ è¿˜æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªæ–°çš„æ­¦å™¨ï¼Œé‚£ä¹ˆæˆ‘çœŸçš„å»ºè®®ä½ å»ä½¿ç”¨ä¸€ä¸‹ï¼Œæ„Ÿå—ä¸‹è¿™ä¸ªæ–°æ­¦å™¨çš„å¿«å‡†ç‹ ï¼Œæ„Ÿå—ä¸‹è¿™ä¸ªæ–°æ¶æ„çš„ç²¾å¦™è§£è€¦ã€‚

### ä»‹ç»

2018å¹´è°·æ­ŒI/Oï¼Œ`Jetpack`æ¨ªç©ºå‡ºä¸–ï¼Œå®˜æ–¹ä»‹ç»å¦‚ä¸‹ï¼š

> Jetpack æ˜¯ä¸€å¥—åº“ã€å·¥å…·å’ŒæŒ‡å—ï¼Œå¯å¸®åŠ©å¼€å‘è€…æ›´è½»æ¾åœ°ç¼–å†™ä¼˜è´¨åº”ç”¨ã€‚è¿™äº›ç»„ä»¶å¯å¸®åŠ©æ‚¨éµå¾ªæœ€ä½³åšæ³•ã€è®©æ‚¨æ‘†è„±ç¼–å†™æ ·æ¿ä»£ç çš„å·¥ä½œå¹¶ç®€åŒ–å¤æ‚ä»»åŠ¡ï¼Œä»¥ä¾¿æ‚¨å°†ç²¾åŠ›é›†ä¸­æ”¾åœ¨æ‰€éœ€çš„ä»£ç ä¸Šã€‚

ä¸€ç›´ä»¥æ¥ï¼Œ`Androidå¼€å‘`éƒ½å……æ–¥äº†å¤§é‡çš„ä¸è§„èŒƒçš„æ“ä½œå’Œé‡å¤ä»£ç ï¼Œæ¯”å¦‚ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼Œå¼€å‘è¿‡ç¨‹çš„é‡å¤ï¼Œé¡¹ç›®æ¶æ„çš„é€‰æ‹©ç­‰ç­‰ã€‚æ‰€ä»¥`Google`ä¸ºäº†è§„èŒƒå¼€å‘è¡Œä¸ºï¼Œå°±æ¨å‡ºè¿™å¥—æŒ‡å—ï¼Œæ—¨åœ¨è®©å¼€å‘è€…ä»¬èƒ½å¤Ÿ`æ›´å¥½ï¼Œæ›´å¿«ï¼Œæ›´è§„èŒƒ`åœ°å¼€å‘å‡ºä¼˜è´¨åº”ç”¨ã€‚

å½“ç„¶ï¼Œè¿™ä¸¤å¹´çš„å®è·µä¹Ÿç¡®å®è¯æ˜äº†`Jetpack`åšåˆ°äº†å®ƒä»‹ç»çš„é‚£æ ·ï¼Œä¾¿æ·ï¼Œå¿«é€Ÿï¼Œä¼˜è´¨ã€‚æ‰€ä»¥æˆ‘ä»¬ä½œä¸ºå¼€å‘è€…è¿˜æ˜¯åº”è¯¥æ—©ç‚¹åº”ç”¨åˆ°è¿™äº›å·¥å…·ï¼Œæé«˜è‡ªå·±çš„`å¼€å‘æ•ˆç‡`ï¼Œä¹Ÿè§„èŒƒæˆ‘ä»¬è‡ªå·±çš„å¼€å‘è¡Œä¸ºã€‚

ä»Šå¤©ç»™å¤§å®¶å¸¦æ¥çš„æ˜¯Jetpackä¸­çš„æ¶æ„ç»„ä»¶ï¼Œè¿™ä¸ªæ¨¡å—çš„ç»„ä»¶å¯ä»¥è¯´å°±æ˜¯ä¸ºMVVMæ¡†æ¶æœåŠ¡çš„ï¼Œæ¯ä¸ªåº“ä¹Ÿéƒ½æ˜¯å¯ä»¥å•ç‹¬ä½¿ç”¨çš„ã€‚

### Jetpack-æ¶æ„ç»„ä»¶

å…ˆç®€å•è¯´ä¸‹`MVVM`ï¼ŒModelâ€”Viewâ€”ViewModelã€‚

- `Modelå±‚`ä¸»è¦æŒ‡æ•°æ®ï¼Œæ¯”å¦‚æœåŠ¡å™¨æ•°æ®ï¼Œæœ¬åœ°æ•°æ®åº“æ•°æ®ï¼Œæ‰€ä»¥ç½‘ç»œæ“ä½œå’Œæ•°æ®åº“è¯»å–å°±æ˜¯è¿™ä¸€å±‚ï¼Œåªä¿å­˜æ•°æ®ã€‚
- `Viewå±‚`ä¸»è¦æŒ‡UIç›¸å…³ï¼Œæ¯”å¦‚xmlå¸ƒå±€æ–‡ä»¶ï¼ŒActivityç•Œé¢æ˜¾ç¤º
- `ViewModelå±‚`æ˜¯MVVMçš„æ ¸å¿ƒï¼Œè¿æ¥viewå’Œmodelï¼Œéœ€è¦å°†modelçš„æ•°æ®å±•ç¤ºåˆ°viewä¸Šï¼Œä»¥åŠviewä¸Šçš„æ“ä½œæ•°æ®åæ˜ è½¬åŒ–åˆ°modelå±‚ï¼Œæ‰€ä»¥å°±ç›¸å½“äºä¸€ä¸ªåŒå‘ç»‘å®šã€‚

æ‰€ä»¥å°±éœ€è¦ï¼Œ**databinding**è¿›è¡Œæ•°æ®çš„ç»‘å®šï¼Œå•å‘æˆ–è€…åŒå‘ã€‚**viewmodel**è¿›è¡Œæ•°æ®ç®¡ç†ï¼Œç»‘å®šviewå’Œæ•°æ®ã€‚**lifecycle**è¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚**LiveData**è¿›è¡Œæ•°æ®çš„åŠæ—¶åé¦ˆã€‚ è¿«ä¸åŠå¾…äº†å§ï¼Œè·Ÿéšæˆ‘ä¸€èµ·çœ‹çœ‹æ¯ä¸ªåº“çš„ç¥å¥‡ä¹‹å¤„ã€‚

#### æ•°æ®ç»‘å®š

> æ•°æ®ç»‘å®šåº“æ˜¯ä¸€ç§æ”¯æŒåº“ï¼Œå€ŸåŠ©è¯¥åº“ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å£°æ˜æ€§æ ¼å¼ï¼ˆè€Œéç¨‹åºåŒ–åœ°ï¼‰å°†å¸ƒå±€ä¸­çš„ç•Œé¢ç»„ä»¶ç»‘å®šåˆ°åº”ç”¨ä¸­çš„æ•°æ®æºã€‚

ä¸»è¦æŒ‡çš„å°±æ˜¯æ•°æ®ç»‘å®šåº“`DataBinding`ï¼Œä¸‹é¢ä»å…­ä¸ªæ–¹é¢å…·ä½“ä»‹ç»ä¸‹

é…ç½®åº”ç”¨ä½¿ç”¨æ•°æ®ç»‘å®šï¼š



```bash
   android {
        ...
        dataBinding {
            enabled = true
        }
    }

å¤åˆ¶ä»£ç 
```

1ï¼‰**å¸ƒå±€å’Œç»‘å®šè¡¨è¾¾å¼**
é€šè¿‡æ•°æ®ç»‘å®šï¼Œæˆ‘ä»¬å¯ä»¥è®©xmlå¸ƒå±€æ–‡ä»¶ä¸­çš„viewä¸æ•°æ®å¯¹è±¡è¿›è¡Œç»‘å®šå’Œèµ‹å€¼ï¼Œå¹¶ä¸”å¯ä»¥å€ŸåŠ©è¡¨è¾¾å¼è¯­è¨€ç¼–å†™è¡¨è¾¾å¼æ¥å¤„ç†è§†å›¾åˆ†æ´¾çš„äº‹ä»¶ã€‚ä¸¾ä¸ªğŸŒ°ï¼š



```kotlin
    //å¸ƒå±€ activity_main.xml
    <?xml version="1.0" encoding="utf-8"?>
    <layout xmlns:android="http://schemas.android.com/apk/res/android">
       <data>
           <variable name="user" type="com.example.User"/>
       </data>
       <TextView android:layout_width="wrap_content"
           android:layout_height="wrap_content"
           android:text="@{user.name}"/>
    </layout>

    //å®ä½“ç±»User
    data class User(val name: String)

    //Activityèµ‹å€¼
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        val binding: ActivityMainBinding = DataBindingUtil.setContentView(
                this, R.layout.activity_main)
        binding.user = User("Bob")
    }

å¤åˆ¶ä»£ç 
```

é€šè¿‡`@{}`ç¬¦å·ï¼Œå¯ä»¥åœ¨å¸ƒå±€ä¸­ä½¿ç”¨æ•°æ®å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡DataBindingUtilè·å–èµ‹å€¼å¯¹è±¡ã€‚å¹¶ä¸”`@{}`é‡Œé¢çš„è¡¨è¾¾å¼è¯­è¨€æ”¯æŒå¤šç§è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ç®—æœ¯è¿ç®—ç¬¦ï¼Œé€»è¾‘è¿ç®—ç¬¦ç­‰ç­‰ã€‚

2ï¼‰**å¯è§‚å¯Ÿçš„æ•°æ®å¯¹è±¡**
å¯è§‚å¯Ÿæ€§æ˜¯æŒ‡ä¸€ä¸ªå¯¹è±¡å°†å…¶æ•°æ®å˜åŒ–å‘ŠçŸ¥å…¶ä»–å¯¹è±¡çš„èƒ½åŠ›ã€‚é€šè¿‡æ•°æ®ç»‘å®šåº“ï¼Œæ‚¨å¯ä»¥è®©å¯¹è±¡ã€å­—æ®µæˆ–é›†åˆå˜ä¸ºå¯è§‚å¯Ÿã€‚

æ¯”å¦‚ä¸Šæ–‡åˆšè¯´åˆ°çš„Userç±»ï¼Œæˆ‘ä»¬å°†nameå±æ€§æ”¹æˆå¯è§‚å¯Ÿå¯¹è±¡ï¼Œ



```kotlin
   data class User(val name: ObservableField<String>)

   val userName = ObservableField<String>()
   userName.set("Bob")

   val binding: ActivityMainBinding = DataBindingUtil.setContentView(
                this, R.layout.activity_main)
   binding.user = User(userName)   
å¤åˆ¶ä»£ç 
```

ç„¶åç»‘å®šåˆ°å¸ƒå±€ä¸­ï¼Œè¿™æ—¶å€™è¿™ä¸ªUserçš„`name`å±æ€§å°±æ˜¯è¢«è§‚å¯Ÿå¯¹è±¡äº†ï¼Œå¦‚æœ`userName`æ”¹å˜ï¼Œå¸ƒå±€é‡Œé¢çš„`TextView`æ˜¾ç¤ºæ•°æ®ä¹Ÿä¼šè·Ÿç€æ”¹å˜ï¼Œè¿™å°±æ˜¯å¯è§‚å¯Ÿæ•°æ®å¯¹è±¡ã€‚

3ï¼‰**ç”Ÿæˆçš„ç»‘å®šç±»**

åˆšæ‰æˆ‘ä»¬è·å–ç»‘å®šå¸ƒå±€æ˜¯é€šè¿‡`DataBindingUtil.setContentView`æ–¹æ³•ç”ŸæˆActivityMainBindingå¯¹è±¡å¹¶ç»‘å®šå¸ƒå±€ã€‚é‚£ä¹ˆActivityMainBindingç±»æ˜¯æ€ä¹ˆç”Ÿæˆçš„å‘¢ï¼Ÿåªè¦ä½ çš„å¸ƒå±€ç”¨`layout`å±æ€§åŒ…å›´ï¼Œç¼–è¯‘åå°±ä¼šè‡ªåŠ¨ç”Ÿæˆç»‘å®šç±»ï¼Œç±»åç§°åŸºäºå¸ƒå±€æ–‡ä»¶çš„åç§°ï¼Œå®ƒä¼šè½¬æ¢ä¸º `Pascal` å¤§å°å†™å½¢å¼å¹¶åœ¨æœ«å°¾æ·»åŠ  Binding åç¼€ã€‚

æ­£å¸¸åˆ›å»ºç»‘å®šå¯¹è±¡æ˜¯é€šè¿‡å¦‚ä¸‹å†™æ³•ï¼š



```kotlin
    //Activity
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        val binding: MyLayoutBinding = MyLayoutBinding.inflate(layoutInflater)
        setContentView(binding.root)
    }

    //Fragment
    @Nullable
    fun onCreateView( inflater: LayoutInflater?, container: ViewGroup?, savedInstanceState: Bundle?): View? {
        mDataBinding = DataBindingUtil.inflate(inflater, R.layout.fragment_layout, container, false)
        return mDataBinding.getRoot()
    }

å¤åˆ¶ä»£ç 
```

4ï¼‰**ç»‘å®šé€‚é…å™¨**

é€‚é…å™¨è¿™é‡ŒæŒ‡çš„æ˜¯å¸ƒå±€ä¸­çš„å±æ€§è®¾ç½®ï¼Œ`android:text="@{user.name}"`è¡¨è¾¾å¼ä¸ºä¾‹ï¼Œåº“ä¼šæŸ¥æ‰¾æ¥å—`user.getName()`æ‰€è¿”å›ç±»å‹çš„`setText(arg)` æ–¹æ³•ã€‚ é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªé€‚é…å™¨äº†ï¼Œä¹Ÿå°±æ˜¯å¸ƒå±€é‡Œé¢çš„å±æ€§æˆ‘ä»¬å¯ä»¥éšä¾¿å®šä¹‰å®ƒçš„åå­—å’Œä½œç”¨ã€‚æ¥ä¸ªğŸŒ°



```kotlin
    @BindingAdapter("imageUrl")
    fun loadImage(view: ImageView, url: String) {
        Picasso.get().load(url).into(view)
    }

    <ImageView app:imageUrl="@{venue.imageUrl}" />

å¤åˆ¶ä»£ç 
```

åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªå¤–éƒ¨å¯ä»¥è®¿é—®çš„æ–¹æ³•`loadImage`ï¼Œæ³¨é‡Š`@BindingAdapter`é‡Œé¢çš„å±æ€§ä¸ºä½ éœ€è¦å®šä¹‰çš„å±æ€§åç§°ï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯imageUrlã€‚æ‰€ä»¥åœ¨å¸ƒå±€ä¸­å°±å¯ä»¥ä½¿ç”¨`app:imageUrl`ï¼Œå¹¶ä¼ å€¼ä¸ºStringç±»å‹ï¼Œç³»ç»Ÿå°±ä¼šæ‰¾åˆ°è¿™ä¸ªé€‚é…å™¨æ–¹æ³•å¹¶æ‰§è¡Œã€‚

5ï¼‰**å°†å¸ƒå±€è§†å›¾ç»‘å®šåˆ°æ¶æ„ç»„ä»¶**
è¿™ä¸€å—å°±æ˜¯å®é™…åº”ç”¨äº†ï¼Œå’Œjetpackå…¶ä»–ç»„ä»¶ç›¸ç»“åˆä½¿ç”¨ï¼Œå½¢æˆå®Œæ•´çš„`MVVM`åˆ†å±‚æ¶æ„ã€‚



```kotlin
        // Obtain the ViewModel component.
        val userModel: UserViewModel by viewModels()

        // Inflate view and obtain an instance of the binding class.
        val binding: ActivityDatabindingMvvmBinding =
            DataBindingUtil.setContentView(this, R.layout.activity_databinding_mvvm)

        // Assign the component to a property in the binding class.
        binding.viewmodel = userModel

    <data>
        <variable
            name="viewmodel"
            type="com.panda.jetpackdemo.dataBinding.UserViewModel" />
    </data>

    class UserViewModel : ViewModel() {
    val currentName: MutableLiveData<String> by lazy {
        MutableLiveData<String>()
    }

    init {
        currentName.value="zzz"
    }
}
å¤åˆ¶ä»£ç 
```

6ï¼‰**åŒå‘æ•°æ®ç»‘å®š**

åˆšæ‰æˆ‘ä»¬ä»‹ç»çš„éƒ½æ˜¯å•å‘ç»‘å®šï¼Œä¹Ÿå°±æ˜¯å¸ƒå±€ä¸­viewç»‘å®šäº†æ•°æ®å¯¹è±¡ï¼Œé‚£ä¹ˆå¦‚ä½•è®©æ•°æ®å¯¹è±¡ä¹Ÿå¯¹viewäº§ç”Ÿç»‘å®šå‘¢ï¼Ÿä¹Ÿå°±æ˜¯`viewæ”¹å˜`çš„æ—¶å€™æ•°æ®å¯¹è±¡ä¹Ÿèƒ½æ¥æ”¶åˆ°è®¯æ¯ï¼Œå½¢æˆ`åŒå‘ç»‘å®š`ã€‚

å¾ˆç®€å•ï¼Œæ¯”å¦‚ä¸€ä¸ªEditTextï¼Œéœ€æ±‚æ˜¯EditTextæ”¹å˜çš„æ—¶å€™ï¼Œuserå¯¹è±¡nameæ•°æ®ä¹Ÿä¼šè·Ÿç€æ”¹å˜ï¼Œåªéœ€è¦æŠŠä¹‹å‰çš„"@{}"æ”¹æˆ"@={}"



```xml
    //å¸ƒå±€ activity_main.xml
    <?xml version="1.0" encoding="utf-8"?>
    <layout xmlns:android="http://schemas.android.com/apk/res/android">
       <data>
           <variable name="user" type="com.example.User"/>
       </data>
       <EditText android:layout_width="wrap_content"
           android:layout_height="wrap_content"
           android:text="@={user.name}"/>
    </layout>

å¤åˆ¶ä»£ç 
```

å¾ˆç®€å•å§ï¼ŒåŒæ ·ï¼Œè¿™ä¸ªåŒå‘ç»‘å®šåŠŸèƒ½ä¹Ÿæ˜¯æ”¯æŒè‡ªå®šä¹‰çš„ã€‚æ¥ä¸ªğŸŒ°



```kotlin
object SwipeRefreshLayoutBinding {

    //æ–¹æ³•1ï¼Œæ•°æ®ç»‘å®šåˆ°view
    @JvmStatic
    @BindingAdapter("app:bind_refreshing")
    fun setSwipeRefreshLayoutRefreshing(swipeRefreshLayout: SwipeRefreshLayout,newValue: Boolean) {
        if (swipeRefreshLayout.isRefreshing != newValue)
            swipeRefreshLayout.isRefreshing = newValue
    }

    //æ–¹æ³•1ï¼Œviewæ”¹å˜ä¼šé€šçŸ¥bind_refreshingChangedï¼Œå¹¶ä¸”ä»è¯¥æ–¹æ³•è·å–viewçš„æ•°æ®
    @JvmStatic
    @InverseBindingAdapter(attribute = "app:bind_refreshing",event = "app:bind_refreshingChanged")
    fun isSwipeRefreshLayoutRefreshing(swipeRefreshLayout: SwipeRefreshLayout): Boolean =swipeRefreshLayout.isRefreshing

    //æ–¹æ³•3ï¼Œviewå¦‚ä½•æ”¹å˜æ¥å½±å“æ•°æ®å†…å®¹  
    @JvmStatic
    @BindingAdapter("app:bind_refreshingChanged",requireAll = false)
    fun setOnRefreshListener(swipeRefreshLayout: SwipeRefreshLayout,bindingListener: InverseBindingListener?) {
        if (bindingListener != null)
            swipeRefreshLayout.setOnRefreshListener {
                bindingListener.onChange()
            }
    }
}

<androidx.swiperefreshlayout.widget.SwipeRefreshLayout
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        app:bind_refreshing="@={viewModel.refreshing }">
</androidx.swiperefreshlayout.widget.SwipeRefreshLayout>

å¤åˆ¶ä»£ç 
```

ç®€å•è¯´æ˜ä¸‹ï¼Œé¦–å…ˆé€šè¿‡`bind_refreshing`å±æ€§ï¼Œå°†æ•°æ®`viewModel.refreshing`ç»‘å®šåˆ°viewä¸Šï¼Œè¿™æ ·æ•°æ®å˜åŒ–ï¼Œviewä¹Ÿä¼šè·Ÿç€å˜åŒ–ã€‚ç„¶åviewå˜åŒ–çš„æ—¶å€™ï¼Œé€šè¿‡`InverseBindingAdapter`æ³¨é‡Šï¼Œä¼šè°ƒç”¨`bind_refreshingChanged`äº‹ä»¶ï¼Œè€Œbind_refreshingChangedäº‹ä»¶å‘Šè¯‰äº†æˆ‘ä»¬viewä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œæ•°æ®çš„ä¿®æ”¹ï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ä¹Ÿå°±æ˜¯swipeRefreshLayoutä¸‹æ»‘çš„æ—¶å€™ä¼šå¯¼è‡´æ•°æ®è¿›è¡Œæ”¹å˜ï¼Œäºæ˜¯æ•°æ®å¯¹è±¡ä¼šä»`isSwipeRefreshLayoutRefreshing`æ–¹æ³•è·å–åˆ°æœ€æ–°çš„æ•°å€¼ï¼Œä¹Ÿå°±æ˜¯ä»viewæ›´æ–°è¿‡æ¥çš„æ•°æ®ã€‚

è¿™é‡Œè¦æ³¨æ„çš„ä¸€ä¸ªç‚¹æ˜¯ï¼ŒåŒå‘ç»‘å®šè¦è€ƒè™‘åˆ°æ­»å¾ªç¯é—®é¢˜ï¼Œå½“Viewè¢«æ”¹å˜ï¼Œæ•°æ®å¯¹è±¡å¯¹åº”å‘ç”Ÿæ›´æ–°ï¼ŒåŒæ—¶ï¼Œè¿™ä¸ªæ›´æ–°åˆå›é€šçŸ¥Viewå±‚å»åˆ·æ–°UIï¼Œç„¶åviewè¢«æ”¹å˜åˆä¼šå¯¼è‡´æ•°æ®å¯¹è±¡æ›´æ–°ï¼Œæ— é™å¾ªç¯ä¸‹å»äº†ã€‚æ‰€ä»¥é˜²æ­¢æ­»å¾ªç¯çš„åšæ³•å°±æ˜¯åˆ¤æ–­viewçš„æ•°æ®çŠ¶æ€ï¼Œå½“å‘ç”Ÿæ”¹å˜çš„æ—¶å€™æ‰å»æ›´æ–°viewã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Fdata-binding)
[Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2FdataBinding)

#### Lifecycles

> ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶å¯æ‰§è¡Œæ“ä½œæ¥å“åº”å¦ä¸€ä¸ªç»„ä»¶ï¼ˆå¦‚ Activity å’Œ Fragmentï¼‰çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„å˜åŒ–ã€‚è¿™äº›ç»„ä»¶æœ‰åŠ©äºæ‚¨å†™å‡ºæ›´æœ‰æ¡ç†ä¸”å¾€å¾€æ›´ç²¾ç®€çš„ä»£ç ï¼Œè¿™æ ·çš„ä»£ç æ›´æ˜“äºç»´æŠ¤ã€‚

`Lifecycles`ï¼Œç§°ä¸ºç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥å‹ç»„ä»¶ï¼Œå¯ä»¥æ„ŸçŸ¥å’Œå“åº”å¦ä¸€ä¸ªç»„ä»¶ï¼ˆå¦‚ Activity å’Œ Fragmentï¼‰çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„å˜åŒ–ã€‚

å¯èƒ½æœ‰äººä¼šç–‘æƒ‘äº†ï¼Œç”Ÿå‘½å‘¨æœŸå°±é‚£å‡ ä¸ªï¼Œæˆ‘ä¸ºå•¥è¿˜è¦å¯¼å…¥ä¸€ä¸ªåº“å‘¢ï¼Ÿæœ‰äº†åº“éš¾é“å°±ä¸ç”¨å†™ç”Ÿå‘½å‘¨æœŸäº†å—ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ ä¸¾ä¸ªğŸŒ°ï¼Œè®©ä½ æ„Ÿå—ä¸‹ã€‚

é¦–å…ˆå¯¼å…¥åº“ï¼Œå¯ä»¥æ ¹æ®å®é™…é¡¹ç›®æƒ…å†µå¯¼å…¥



```dart
        // ViewModel
        implementation "androidx.lifecycle:lifecycle-viewmodel-ktx:$lifecycle_version"
        // LiveData
        implementation "androidx.lifecycle:lifecycle-livedata-ktx:$lifecycle_version"
        // Lifecycles only (without ViewModel or LiveData)
        implementation "androidx.lifecycle:lifecycle-runtime-ktx:$lifecycle_version"
        //.......
å¤åˆ¶ä»£ç 
```

ç°åœ¨æœ‰ä¸€ä¸ªå®šä½ç›‘å¬å™¨ï¼Œéœ€è¦åœ¨`Activity`å¯åŠ¨çš„æ—¶å€™å¼€å¯ï¼Œé”€æ¯çš„æ—¶å€™å…³é—­ã€‚æ­£å¸¸ä»£ç å¦‚ä¸‹ï¼š



```kotlin
class BindingActivity : AppCompatActivity() {

    private lateinit var myLocationListener: MyLocationListener

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        myLocationListener = MyLocationListener(this) { location ->
            // update UI
        }
    }
    public override fun onStart() {
        super.onStart()
        myLocationListener.start()       
    }
    public override fun onStop() {
        super.onStop()
        myLocationListener.stop()
    }

    internal class MyLocationListener(
            private val context: Context,
            private val callback: (Location) -> Unit
    ) {
        fun start() {
            // connect to system location service
        }
        fun stop() {
            // disconnect from system location service
        }
    }

}
å¤åˆ¶ä»£ç 
```

ä¹ä¸€çœ‹ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜æ˜¯å§ï¼Œä½†æ˜¯å¦‚æœéœ€è¦ç®¡ç†ç”Ÿå‘½å‘¨æœŸçš„ç±»ä¸€å¤šï¼Œæ˜¯ä¸æ˜¯å°±ä¸å¥½ç®¡ç†äº†ã€‚æ‰€æœ‰çš„ç±»éƒ½è¦åœ¨Activityé‡Œé¢ç®¡ç†ï¼Œè¿˜å®¹æ˜“æ¼æ‰ã€‚ æ‰€ä»¥è§£å†³åŠæ³•å°±æ˜¯å®ç°`è§£è€¦`ï¼Œè®©éœ€è¦ç®¡ç†ç”Ÿå‘½å‘¨æœŸçš„ç±»`è‡ªå·±ç®¡ç†`ï¼Œè¿™æ ·Activityä¹Ÿä¸ä¼šé—æ¼å’Œè‡ƒè‚¿äº†ã€‚ä¸Šä»£ç ï¼š



```kotlin
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        myLocationListener = MyLocationListener(this) { location ->
            // update UI
        }
       lifecycle.addObserver(myLocationListener)
    }

    internal class MyLocationListener (
            private val context: Context,
            private val callback: (Location) -> Unit
    ): LifecycleObserver {

        @OnLifecycleEvent(Lifecycle.Event.ON_START)
        fun start() {

        }

        @OnLifecycleEvent(Lifecycle.Event.ON_STOP)
        fun stop() {
            // disconnect if connected
        }
    }
å¤åˆ¶ä»£ç 
```

å¾ˆç®€å•å§ï¼Œåªè¦å®ç°`LifecycleObserver`æ¥å£ï¼Œå°±å¯ä»¥ç”¨æ³¨é‡Šçš„æ–¹å¼æ‰§è¡Œæ¯ä¸ªç”Ÿå‘½å‘¨æœŸè¦æ‰§è¡Œçš„æ–¹æ³•ã€‚ç„¶ååœ¨Activityé‡Œé¢`addObserver`ç»‘å®šå³å¯ã€‚

åŒæ ·çš„ï¼Œ`Lifecycle`ä¹Ÿæ”¯æŒè‡ªå®šä¹‰ç”Ÿå‘½å‘¨æœŸï¼Œåªè¦ç»§æ‰¿LifecycleOwnerå³å¯ï¼Œç„¶åé€šè¿‡`markState`æ–¹æ³•è®¾å®šè‡ªå·±ç±»çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸¾ä¸ªğŸŒ°



```kotlin
class BindingActivity : AppCompatActivity(), LifecycleOwner {

    private lateinit var lifecycleRegistry: LifecycleRegistry

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        lifecycleRegistry = LifecycleRegistry(this)
        lifecycleRegistry.markState(Lifecycle.State.CREATED)
    }

    public override fun onStart() {
        super.onStart()
        lifecycleRegistry.markState(Lifecycle.State.STARTED)
    }
}    
å¤åˆ¶ä»£ç 
```

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Farchitecture%2Flifecycle)
[Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Flifecycle)

#### LiveData

> LiveData æ˜¯ä¸€ç§å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨å™¨ç±»ã€‚ä¸å¸¸è§„çš„å¯è§‚å¯Ÿç±»ä¸åŒï¼ŒLiveData å…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›ï¼Œæ„æŒ‡å®ƒéµå¾ªå…¶ä»–åº”ç”¨ç»„ä»¶ï¼ˆå¦‚ Activityã€Fragment æˆ– Serviceï¼‰çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ç§æ„ŸçŸ¥èƒ½åŠ›å¯ç¡®ä¿ LiveData ä»…æ›´æ–°å¤„äºæ´»è·ƒç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„åº”ç”¨ç»„ä»¶è§‚å¯Ÿè€…ã€‚

`LiveData` æ˜¯ä¸€ç§å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨å™¨ç±»ã€‚ ç­‰ç­‰ï¼Œè¿™ä¸ªä»‹ç»å¥½åƒä¼¼æ›¾ç›¸è¯†ï¼Ÿå¯¹ï¼Œå‰é¢è¯´æ•°æ®ç»‘å®šçš„æ—¶å€™å°±æœ‰ä¸€ä¸ªå¯è§‚å¯Ÿçš„æ•°æ®å¯¹è±¡`ObservableField`ã€‚é‚£ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ

1ï¼‰`LiveData` å…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›ï¼Œå¯ä»¥æ„ŸçŸ¥åˆ°Activityç­‰çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™æ ·æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿå¾ˆå¸¸è§çš„ä¸€ç‚¹å°±æ˜¯å¯ä»¥å‡å°‘å†…å­˜æ³„æ¼å’Œå´©æºƒæƒ…å†µäº†å‘€ï¼Œæƒ³æƒ³ä»¥å‰ä½ çš„é¡¹ç›®ä¸­é’ˆå¯¹ç½‘ç»œæ¥å£è¿”å›æ•°æ®çš„æ—¶å€™éƒ½è¦åˆ¤æ–­å½“å‰ç•Œé¢æ˜¯å¦é”€æ¯ï¼Œç°åœ¨LiveDataå°±å¸®ä½ è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚

å…·ä½“ä¸ºä»€ä¹ˆèƒ½è§£å†³å´©æºƒå’Œæ³„æ¼é—®é¢˜å‘¢ï¼Ÿ

- `ä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼` è§‚å¯Ÿè€…ä¼šç»‘å®šåˆ° Lifecycle å¯¹è±¡ï¼Œå¹¶åœ¨å…¶å…³è”çš„ç”Ÿå‘½å‘¨æœŸé­åˆ°é”€æ¯åè¿›è¡Œè‡ªæˆ‘æ¸…ç†ã€‚
- `ä¸ä¼šå›  Activity åœæ­¢è€Œå¯¼è‡´å´©æºƒ` å¦‚æœè§‚å¯Ÿè€…çš„ç”Ÿå‘½å‘¨æœŸå¤„äºéæ´»è·ƒçŠ¶æ€ï¼ˆå¦‚è¿”å›æ ˆä¸­çš„ Activityï¼‰ï¼Œåˆ™å®ƒä¸ä¼šæ¥æ”¶ä»»ä½• LiveData äº‹ä»¶ã€‚
- `è‡ªåŠ¨åˆ¤æ–­ç”Ÿå‘½å‘¨æœŸå¹¶å›è°ƒæ–¹æ³•` å¦‚æœè§‚å¯Ÿè€…çš„ç”Ÿå‘½å‘¨æœŸå¤„äº STARTED æˆ– RESUMEDçŠ¶æ€ï¼Œåˆ™ LiveData ä¼šè®¤ä¸ºè¯¥è§‚å¯Ÿè€…å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œå°±ä¼šè°ƒç”¨onActiveæ–¹æ³•ï¼Œå¦åˆ™ï¼Œå¦‚æœ LiveData å¯¹è±¡æ²¡æœ‰ä»»ä½•æ´»è·ƒè§‚å¯Ÿè€…æ—¶ï¼Œä¼šè°ƒç”¨ onInactive()æ–¹æ³•ã€‚

2ï¼‰ LiveDataæ›´æ–°æ•°æ®æ›´çµæ´»ï¼Œä¸ä¸€å®šæ˜¯æ”¹å˜æ•°æ®ï¼Œè€Œæ˜¯è°ƒç”¨æ–¹æ³•`ï¼ˆpostValueæˆ–è€…setValueï¼‰`çš„æ–¹å¼è¿›è¡ŒUIæ›´æ–°æˆ–è€…å…¶ä»–æ“ä½œã€‚

å¥½äº†ã€‚è¿˜æ˜¯ä¸¾ä¸ªğŸŒ°æ›´ç›´è§‚çš„çœ‹çœ‹å§ï¼š



```kotlin
    //å¯¼å…¥åº“ï¼š
    implementation "androidx.lifecycle:lifecycle-livedata-ktx:2.2.0"

    class StockLiveData(symbol: String) : LiveData<BigDecimal>() {
        private val stockManager = StockManager(symbol)

        private val listener = { price: BigDecimal ->
            value = price
        }

        override fun onActive() {
            stockManager.requestPriceUpdates(listener)
        }

        override fun onInactive() {
            stockManager.removeUpdates(listener)
        }
    }

    public class MyFragment : Fragment() {
        override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
            super.onViewCreated(view, savedInstanceState)
            val myPriceListener: LiveData<BigDecimal> = StockLiveData("")
            myPriceListener.observe(this, Observer<BigDecimal> { price: BigDecimal? ->
                // ç›‘å¬livedataçš„æ•°æ®å˜åŒ–ï¼Œå¦‚æœè°ƒç”¨äº†setValueæˆ–è€…postValueä¼šè°ƒç”¨è¯¥onChangedæ–¹æ³•
                //æ›´æ–°UIæ•°æ®æˆ–è€…å…¶ä»–å¤„ç†
            })
        }
    }

å¤åˆ¶ä»£ç 
```

è¿™æ˜¯ä¸€ä¸ªè‚¡ç¥¨æ•°æ®å¯¹è±¡ï¼Œ`StockManager`ä¸ºè‚¡ç¥¨ç®¡ç†å™¨ï¼Œå¦‚æœè¯¥å¯¹è±¡æœ‰æ´»è·ƒè§‚å¯Ÿè€…æ—¶ï¼Œå°±å»ç›‘å¬è‚¡ç¥¨å¸‚åœºçš„æƒ…å†µï¼Œå¦‚æœæ²¡æœ‰æ´»è·ƒè§‚å¯Ÿè€…æ—¶ï¼Œå°±å¯ä»¥æ–­å¼€ç›‘å¬ã€‚ å½“ç›‘å¬åˆ°è‚¡ç¥¨ä¿¡æ¯å˜åŒ–ï¼Œè¯¥è‚¡ç¥¨æ•°æ®å¯¹è±¡å°±ä¼šé€šè¿‡`setValue`æ–¹æ³•è¿›è¡Œæ•°æ®æ›´æ–°ï¼Œååº”åˆ°è§‚å¯Ÿè€…çš„onChangedæ–¹æ³•ã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯`setValue`æ–¹æ³•åªèƒ½åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ï¼Œè€Œ`postValue`åˆ™æ˜¯åœ¨å…¶ä»–çº¿ç¨‹è°ƒç”¨ã€‚ å½“`Fragment`è¿™ä¸ªè§‚å¯Ÿè€…ç”Ÿå‘½å‘¨æœŸå‘ç”Ÿå˜åŒ–æ—¶ï¼Œ`LiveData`å°±ä¼šç§»é™¤è¿™ä¸ªè§‚å¯Ÿè€…ï¼Œä¸å†å‘é€æ¶ˆæ¯ï¼Œæ‰€ä»¥ä¹Ÿå°±é¿å…å´©æºƒé—®é¢˜ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Farchitecture%2Flivedata)
[Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Flivedata)

#### Navigation

> å¯¼èˆª Navigation ç»„ä»¶æ—¨åœ¨ç”¨äºå…·æœ‰ä¸€ä¸ªä¸» Activity å’Œå¤šä¸ª Fragment ç›®çš„åœ°çš„åº”ç”¨ã€‚ä¸» Activity ä¸å¯¼èˆªå›¾ç›¸å…³è”ï¼Œä¸”åŒ…å«ä¸€ä¸ªè´Ÿè´£æ ¹æ®éœ€è¦äº¤æ¢ç›®çš„åœ°çš„ NavHostFragmentã€‚åœ¨å…·æœ‰å¤šä¸ª Activity ç›®çš„åœ°çš„åº”ç”¨ä¸­ï¼Œæ¯ä¸ª Activity å‡æ‹¥æœ‰å…¶è‡ªå·±çš„å¯¼èˆªå›¾ã€‚

æ‰€ä»¥è¯´ç™½äº†ï¼Œ`Navigation`å°±æ˜¯ä¸€ä¸ª`Fragment`çš„ç®¡ç†æ¡†æ¶ã€‚ æ€ä¹ˆå®ç°ï¼Ÿåˆ›å»ºActivityï¼ŒFragmentï¼Œè¿›è¡Œè¿æ¥ã€‚

1ï¼‰**å¯¼å…¥åº“**



```bash
  def nav_version = "2.3.0"
  implementation "androidx.navigation:navigation-fragment-ktx:$nav_version"
  implementation "androidx.navigation:navigation-ui-ktx:$nav_version"
å¤åˆ¶ä»£ç 
```

2ï¼‰**åˆ›å»º3ä¸ªFragmentå’Œä¸€ä¸ªActivity**

3ï¼‰**åˆ›å»ºres/navigation/my_nav.xml æ–‡ä»¶**



```xml
<?xml version="1.0" encoding="utf-8"?>
<navigation xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    xmlns:android="http://schemas.android.com/apk/res/android"
    app:startDestination="@id/myFragment1"
    tools:ignore="UnusedNavigation">

    <fragment
        android:id="@+id/myFragment1"
        android:name="com.example.studynote.blog.jetpack.navigation.MyFragment1"
        android:label="fragment_blank"
        tools:layout="@layout/fragmetn_my_1" >
        <action
            android:id="@+id/action_blankFragment_to_blankFragment2"
            app:destination="@id/myFragment2" />
    </fragment>

    <fragment
        android:id="@+id/myFragment2"
        android:name="com.example.studynote.blog.jetpack.navigation.MyFragment1"
        android:label="fragment_blank"
        tools:layout="@layout/fragmetn_my_1" >
        <action
            android:id="@+id/action_blankFragment_to_blankFragment2"
            app:destination="@id/myFragment3" />
    </fragment>

    <fragment
        android:id="@+id/myFragment3"
        android:name="com.example.studynote.blog.jetpack.navigation.MyFragment1"
        android:label="fragment_blank"
        tools:layout="@layout/fragmetn_my_1" >
    </fragment>
</navigation>

å¤åˆ¶ä»£ç 
```

åœ¨resæ–‡ä»¶å¤¹ä¸‹æ–°å»º`navigation`ç›®å½•ï¼Œå¹¶æ–°å»º`my_nav.xml` æ–‡ä»¶ã€‚é…ç½®å¥½æ¯ä¸ªFragmentï¼Œå…¶ä¸­ï¼š

- `app:startDestination` å±æ€§ä»£è¡¨ä¸€å¼€å§‹æ˜¾ç¤ºçš„fragment
- `android:name` å±æ€§ä»£è¡¨å¯¹åº”çš„Fragmentè·¯å¾„
- `action` ä»£è¡¨è¯¥Fragmentå­˜åœ¨çš„è·³è½¬äº‹ä»¶ï¼Œæ¯”å¦‚myFragment1å¯ä»¥è·³è½¬myFragment2ã€‚

1. **ä¿®æ”¹Activityçš„å¸ƒå±€æ–‡ä»¶ï¼š**



```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
xmlns:android="http://schemas.android.com/apk/res/android"
xmlns:app="http://schemas.android.com/apk/res-auto"
android:id="@+id/container"
android:layout_width="match_parent"
android:layout_height="match_parent">

<fragment
    android:id="@+id/nav_host_fragment"
    android:name="androidx.navigation.fragment.NavHostFragment"
    android:layout_width="0dp"
    android:layout_height="0dp"
    app:layout_constraintBottom_toBottomOf="parent"
    app:layout_constraintLeft_toLeftOf="parent"
    app:layout_constraintRight_toRightOf="parent"
    app:layout_constraintTop_toTopOf="parent"
    app:defaultNavHost="true"
    app:navGraph="@navigation/my_nav" />

</androidx.constraintlayout.widget.ConstraintLayout>

å¤åˆ¶ä»£ç 
```

å¯ä»¥çœ‹åˆ°ï¼ŒActivityçš„å¸ƒå±€æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªfragmentæ§ä»¶ï¼Œnameä¸ºNavHostFragmentï¼Œ`navGraph`ä¸ºåˆšæ‰æ–°å»ºçš„mynavigationæ–‡ä»¶ã€‚

5ï¼‰**é…ç½®å®Œäº†ä¹‹åï¼Œå°±å¯ä»¥è®¾ç½®å…·ä½“çš„è·³è½¬é€»è¾‘äº†ã€‚**



```kotlin
    override fun onClick(v: View) {
    //ä¸å¸¦å‚æ•°
 v.findNavController().navigate(R.id.action_blankFragment_to_blankFragment2)
   //å¸¦å‚æ•°
    var bundle = bundleOf("amount" to amount)
    v.findNavController().navigate(R.id.confirmationAction, bundle)

    }

    //æ¥æ”¶æ•°æ®
    tv.text = arguments?.getString("amount")

å¤åˆ¶ä»£ç 
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè·³è½¬è¿™å—å®˜æ–¹å»ºè®®ç”¨`Safe Args` çš„Gradle æ’ä»¶ï¼Œè¯¥æ’ä»¶å¯ä»¥ç”Ÿæˆç®€å•çš„ `object å’Œ builder`ç±»ï¼Œä»¥ä¾¿ä»¥ç±»å‹å®‰å…¨çš„æ–¹å¼æµè§ˆå’Œè®¿é—®ä»»ä½•å…³è”çš„å‚æ•°ã€‚è¿™é‡Œå°±ä¸ç»†è¯´äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»[å®˜ç½‘çœ‹çœ‹](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fguide%2Fnavigation%2Fnavigation-getting-started%23ensure_type-safety_by_using_safe_args)

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Fguide%2Fnavigation%2F)
[Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fnavigation)

#### Room

> Room æŒä¹…æ€§åº“åœ¨ SQLite çš„åŸºç¡€ä¸Šæä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿåœ¨å……åˆ†åˆ©ç”¨ SQLite çš„å¼ºå¤§åŠŸèƒ½çš„åŒæ—¶ï¼Œè·äº«æ›´å¼ºå¥çš„æ•°æ®åº“è®¿é—®æœºåˆ¶ã€‚

æ‰€ä»¥`Room`å°±æ˜¯ä¸€ä¸ªæ•°æ®åº“æ¡†æ¶ã€‚é—®é¢˜æ¥äº†ï¼Œå¸‚é¢ä¸Šé‚£ä¹ˆå¤šæ•°æ®åº“ç»„ä»¶ï¼Œæ¯”å¦‚`ormLiteï¼Œgreendao`ç­‰ç­‰ï¼Œä¸ºä»€ä¹ˆgoogleè¿˜è¦å‡ºä¸€ä¸ªroomï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿ

- **æ€§èƒ½ä¼˜åŠ¿**ï¼Œä¸€æ¬¡æ•°æ®åº“æ“ä½œä¸»è¦åŒ…æ‹¬ï¼šæ„é€ sqlè¯­å¥â€”ç¼–è¯‘è¯­å¥â€”ä¼ å…¥å‚æ•°â€”æ‰§è¡Œæ“ä½œã€‚`ORMLite`ä¸»è¦åœ¨è·å–å‚æ•°å±æ€§å€¼çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡åå°„è·å–çš„ï¼Œæ‰€ä»¥é€Ÿåº¦è¾ƒæ…¢ã€‚`GreenDao`åœ¨æ„é€ sqlè¯­å¥çš„æ—¶å€™æ˜¯é€šè¿‡ä»£ç æ‹¼æ¥ï¼Œæ‰€ä»¥è¾ƒæ…¢ã€‚`Room`æ˜¯é€šè¿‡æ¥å£æ–¹æ³•çš„æ³¨è§£ç”Ÿæˆsqlè¯­å¥ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘æˆå­—èŠ‚ç çš„æ—¶å€™å°±ç”Ÿæˆäº†sqlè¯­å¥ï¼Œæ‰€ä»¥è¿è¡Œèµ·æ¥è¾ƒå¿«ã€‚
- **æ”¯æŒjetpackå…¶ä»–ç»„ä»¶ï¼ˆæ¯”å¦‚LiveDataï¼ŒPagingï¼‰ä»¥åŠRxJava**ï¼Œè¿™å°±å¥½æ¯”å€ŸåŠ©äº†å½“å‰æ‰€åœ¨çš„ä¼˜åŠ¿ç¯å¢ƒï¼Œå°±èƒ½ç»™ä½ å¸¦æ¥ä¸€äº›å¾—å¤©ç‹¬åšçš„ä¼˜åŠ¿ã€‚å½“ç„¶å®é™…ä½¿ç”¨èµ·æ¥ä¹Ÿç¡®å®è¦æ–¹ä¾¿å¾ˆå¤šï¼Œæ¯”å¦‚`liveData`ç»“åˆï¼Œå°±èƒ½åœ¨æ•°æ®æŸ¥è¯¢åè¿›è¡Œè‡ªåŠ¨UIæ›´æ–°ã€‚

æ—¢ç„¶Roomè¿™ä¹ˆä¼˜ç§€ï¼Œé‚£å°±ç”¨èµ·æ¥å§ã€‚ Roomçš„æ¥å…¥ä¸»è¦æœ‰ä¸‰å¤§ç‚¹ï¼š`DataBaseã€Entityã€Dao`ã€‚åˆ†åˆ«å¯¹åº”æ•°æ®åº“ï¼Œè¡¨å’Œæ•°æ®è®¿é—®ã€‚

1ï¼‰**é¦–å…ˆå¯¼å…¥åº“ï¼š**



```dart
    apply plugin: 'kotlin-kapt'

    dependencies {
      def room_version = "2.2.5"

      implementation "androidx.room:room-runtime:$room_version"
      kapt "androidx.room:room-compiler:$room_version" // For Kotlin use kapt instead of annotationProcessor

      // optional - Kotlin Extensions and Coroutines support for Room
      implementation "androidx.room:room-ktx:$room_version"

      // optional - RxJava support for Room
      implementation "androidx.room:room-rxjava2:$room_version"
    }

å¤åˆ¶ä»£ç 
```

2ï¼‰**å»ºç«‹æ•°æ®åº“ç±»ï¼Œå£°æ˜æ•°æ®åº“è¡¨æˆå‘˜ï¼Œæ•°æ®åº“åç§°ï¼Œæ•°æ®åº“ç‰ˆæœ¬ï¼Œå•ä¾‹ç­‰ç­‰**



```kotlin
@Database(entities = arrayOf(User::class), version = 1)
abstract class UserDb : RoomDatabase() {

    abstract fun userDao(): UserDao

    companion object {
        private var instance: UserDb? = null

        @Synchronized
        fun get(context: Context): UserDb {
            if (instance == null) {
                instance = Room.databaseBuilder(context.applicationContext,
                    UserDb::class.java, "StudentDatabase").build()
            }
            return instance!!
        }
    }
}
å¤åˆ¶ä»£ç 
```

3ï¼‰**å»ºè¡¨ï¼Œå¯ä»¥è®¾ç½®ä¸»é”®ï¼Œå¤–é”®ï¼Œç´¢å¼•ï¼Œè‡ªå¢ç­‰ç­‰**



```kotlin
@Entity
data class User(@PrimaryKey(autoGenerate = true) val id: Int,
                val name: String)
å¤åˆ¶ä»£ç 
```

4ï¼‰**Daoï¼Œæ•°æ®æ“ä½œ**



```kotlin
@Dao
interface UserDao {

    @Query("SELECT * FROM User")
    fun getAllUser(): DataSource.Factory<Int, User>

    @Query("SELECT * FROM User")
    fun getAllUser2(): LiveData<List<User>>

    @Query("SELECT * from user")
    fun getAllUser3(): Flowable<List<User>>

    @Insert
    fun insert(users: List<User>)
}
å¤åˆ¶ä»£ç 
```

ç„¶åå°±å¯ä»¥è¿›è¡Œæ•°æ®åº“æ“ä½œäº†ï¼Œå¾ˆç®€å•å§ã€‚
[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Farchitecture%2Froom)
[Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fpaging_room)

#### Paging

> åˆ†é¡µåº“å¯å¸®åŠ©æ‚¨ä¸€æ¬¡åŠ è½½å’Œæ˜¾ç¤ºä¸€å°å—æ•°æ®ã€‚æŒ‰éœ€è½½å…¥éƒ¨åˆ†æ•°æ®ä¼šå‡å°‘ç½‘ç»œå¸¦å®½å’Œç³»ç»Ÿèµ„æºçš„ä½¿ç”¨é‡ã€‚

æ‰€ä»¥`Paging`å°±æ˜¯ä¸€ä¸ªåˆ†é¡µåº“ï¼Œä¸»è¦ç”¨äºRecycleviewåˆ—è¡¨å±•ç¤ºã€‚ä¸‹é¢æˆ‘å°±ç»“åˆRoomè¯´è¯´Pagingçš„ç”¨æ³•ã€‚ ä½¿ç”¨Pagingä¸»è¦æ³¨æ„ä¸¤ä¸ªç±»ï¼š`PagedListå’ŒPagedListAdapter`ã€‚
1ï¼‰**PagedList**
ç”¨äºåŠ è½½åº”ç”¨æ•°æ®å—ï¼Œç»‘å®šæ•°æ®åˆ—è¡¨ï¼Œè®¾ç½®æ•°æ®é¡µç­‰ã€‚ç»“åˆä¸Šè¿°`Room`çš„Demoæˆ‘ç»§ç»­å†™äº†ä¸€ä¸ª`UserModel`è¿›è¡Œæ•°æ®ç®¡ç†ï¼š



```kotlin
class UserModel(app: Application) : AndroidViewModel(app) {
    val dao = UserDb.get(app).userDao()
    var idNum = 1

    companion object {
        private const val PAGE_SIZE = 10
    }

    //åˆå§‹åŒ–PagedList
    val users = LivePagedListBuilder(
        dao.getAllUser(), PagedList.Config.Builder()
            .setPageSize(PAGE_SIZE)
            .setEnablePlaceholders(true)
            .build()
    ).build()

    //æ’å…¥ç”¨æˆ·
    fun insert() = ioThread {
        dao.insert(newTenUser())
    }

    //è·å–æ–°çš„10ä¸ªç”¨æˆ·
    fun newTenUser(): ArrayList<User> {
        var newUsers = ArrayList<User>()
        for (index in 1..10) {
            newUsers.add(User(0, "bob${++idNum}"))
        }
        return newUsers
    }

}
å¤åˆ¶ä»£ç 
```

2ï¼‰**PagedListAdapter**
ä½¿ç”¨Recycleviewå¿…è¦è¦ç”¨åˆ°adatperï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ç»‘å®šä¸€ä¸ªç»§æ‰¿è‡ª`PagedListAdapter`çš„adapterï¼š



```kotlin
class UserAdapter : PagedListAdapter<User, UserAdapter.UserViewHolder>(diffCallback) {
    override fun onBindViewHolder(holder: UserViewHolder, position: Int) {
        holder.bindTo(getItem(position))
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): UserViewHolder =
        UserViewHolder(parent)

    companion object {

        private val diffCallback = object : DiffUtil.ItemCallback<User>() {
            override fun areItemsTheSame(oldItem: User, newItem: User): Boolean =
                oldItem.id == newItem.id

            override fun areContentsTheSame(oldItem: User, newItem: User): Boolean =
                oldItem == newItem
        }
    }

    class UserViewHolder(parent: ViewGroup) : RecyclerView.ViewHolder(
        LayoutInflater.from(parent.context).inflate(R.layout.list_item, parent, false)) {

        private val tv1 = itemView.findViewById<TextView>(R.id.name)
        var user: User? = null

        fun bindTo(user: User?) {
            this.user = user
            tv1.text = user?.name
        }
    }
}
å¤åˆ¶ä»£ç 
```

è¿™é‡Œè¿˜ç”¨åˆ°äº†`DiffUtil.ItemCallback` ç±»ï¼Œç”¨äºæ¯”è¾ƒæ•°æ®ï¼Œè¿›è¡Œæ•°æ®æ›´æ–°ç”¨ã€‚

okï¼Œæ•°æ®æºï¼Œadapteréƒ½è®¾ç½®å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç›‘å¬æ•°æ®ï¼Œåˆ·æ–°æ•°æ®å°±å¯ä»¥äº†



```kotlin
        // ç›‘å¬usersæ•°æ®ï¼Œæ•°æ®æ”¹å˜è°ƒç”¨submitListæ–¹æ³•
        viewModel.users.observe(this, Observer(adapter::submitList))
å¤åˆ¶ä»£ç 
```

å¯¹ï¼Œå°±æ˜¯è¿™ä¹ˆä¸€å¥ï¼Œç›‘å¬`PagedList`ï¼Œå¹¶ä¸”åœ¨å®ƒæ”¹å˜çš„æ—¶å€™è°ƒç”¨PagedListAdapterçš„`submitList`æ–¹æ³•ã€‚ è¿™åˆ†å±‚å¤Ÿçˆ½å§ï¼Œå…¶å®è¿™ä¹Ÿå°±æ˜¯pagingæˆ–è€…è¯´jetpackç»™æˆ‘ä»¬é¡¹ç›®å¸¦æ¥çš„ä¼˜åŠ¿ï¼Œå±‚å±‚è§£è€¦ï¼Œadapteréƒ½ä¸ç”¨ç»´æŠ¤listæ•°æ®æºäº†ã€‚

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Farchitecture%2Fpaging)
[Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fpaging_room)

#### ViewModel

> ViewModel ç±»æ—¨åœ¨ä»¥æ³¨é‡ç”Ÿå‘½å‘¨æœŸçš„æ–¹å¼å­˜å‚¨å’Œç®¡ç†ç•Œé¢ç›¸å…³çš„æ•°æ®ã€‚ViewModel ç±»è®©æ•°æ®å¯åœ¨å‘ç”Ÿå±å¹•æ—‹è½¬ç­‰é…ç½®æ›´æ”¹åç»§ç»­ç•™å­˜ã€‚

ç»ˆäºè¯´åˆ°`ViewModel`äº†ï¼Œå…¶å®ä¹‹å‰çš„demoéƒ½ç”¨äº†å¥½å¤šéäº†ï¼Œ`ViewModel`ä¸»è¦æ˜¯ä»ç•Œé¢æ§åˆ¶å™¨é€»è¾‘ä¸­åˆ†ç¦»å‡ºè§†å›¾æ•°æ®ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿä¸»è¦ä¸ºäº†è§£å†³ä¸¤å¤§é—®é¢˜ï¼š

- ä»¥å‰Activityä¸­å¦‚æœè¢«ç³»ç»Ÿé”€æ¯æˆ–è€…éœ€è¦é‡æ–°åˆ›å»ºçš„æ—¶å€™ï¼Œé¡µé¢ä¸´æ—¶æ€§æ•°æ®éƒ½ä¼šä¸¢å¤±ï¼Œéœ€è¦é€šè¿‡`onSaveInstanceState()` æ–¹æ³•ä¿å­˜ï¼ŒonCreateæ–¹æ³•ä¸­è¯»å–ã€‚è€Œä¸”æ•°æ®é‡ä¸€å¤§å°±æ›´åŠ ä¸æ–¹ä¾¿äº†ã€‚
- åœ¨Activityä¸­ï¼Œéš¾å…æœ‰äº›å¼‚æ­¥è°ƒç”¨ï¼Œæ‰€ä»¥å°±ä¼šå®¹æ˜“å¯¼è‡´ç•Œé¢é”€æ¯æ—¶å€™ï¼Œè¿™äº›è°ƒç”¨è¿˜å­˜åœ¨ã€‚é‚£å°±ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼æˆ–è€…ç›´æ¥å´©æºƒã€‚

æ‰€ä»¥`ViewModel`è¯ç”Ÿäº†ï¼Œè¿˜æ˜¯è§£è€¦ï¼Œæˆ‘æŠŠæ•°æ®å•ç‹¬æ‹¿å‡ºæ¥ç®¡ç†ï¼Œè¿˜åŠ ä¸Šç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¸å°±å¯ä»¥è§£å†³è¿™äº›é—®é¢˜äº†å—ã€‚è€Œä¸”å½“æ‰€æœ‰è€… Activity å®Œå…¨é”€æ¯ä¹‹åï¼Œ`ViewModel`ä¼šè°ƒç”¨å…¶`onCleared()`æ–¹æ³•ï¼Œä»¥ä¾¿æ¸…ç†èµ„æºã€‚

æ¥ä¸‹æ¥ä¸¾ä¸ªğŸŒ°ï¼Œçœ‹çœ‹ViewModelå…·ä½“æ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼š



```kotlin
def lifecycle_version = "2.2.0"
// ViewModel
implementation "androidx.lifecycle:lifecycle-viewmodel-ktx:$lifecycle_version"

class SharedViewModel : ViewModel() {
    var userData = MutableLiveData<User>()

    fun select(item: User) {
        userData.value = item
    }

    override fun onCleared() {
        super.onCleared()
    }
}

class MyFragment1 : Fragment() {
    private lateinit var btn: Button

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        val model=activity?.let { ViewModelProvider(it).get(SharedViewModel::class.java) }
        btn.setOnClickListener{
            model?.select(User(0,"bob"))
        }
    }
}

class MyFragment2 : Fragment() {
    private lateinit var btn: Button

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        val model=activity?.let { ViewModelProvider(it).get(SharedViewModel::class.java) }
        model?.userData?.observe(viewLifecycleOwner, Observer<User> { item ->
            // Update the UI
        })
    }
}

å¤åˆ¶ä»£ç 
```

Fragmentä¸­ï¼Œè·å–åˆ°`viewmodel`çš„å®ä¾‹ï¼Œç„¶åè¿›è¡Œæ•°æ®ç›‘å¬ç­‰æ“ä½œã€‚ç­‰ç­‰ï¼Œä½ èƒ½å‘ç°ä»€ä¹ˆä¸ï¼Ÿ å¯¹äº†ï¼Œæ•°æ®é€šä¿¡ã€‚ä¸åŒçš„ Fragment å¯ä»¥ä½¿ç”¨å…¶çˆ¶Activityå…±äº«`ViewModel` æ¥è¿›è¡Œæ•°æ®çš„é€šä¿¡ï¼Œå‰å®³å§ã€‚è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ç”¨æ³•ï¼Œå»é¡¹ç›®ä¸­æ…¢æ…¢å‘ç°å§ï¼

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Farchitecture%2Fviewmodel)
[Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fviewmodel)

#### WorkManager

> ä½¿ç”¨ WorkManager API å¯ä»¥è½»æ¾åœ°è°ƒåº¦å³ä½¿åœ¨åº”ç”¨é€€å‡ºæˆ–è®¾å¤‡é‡å¯æ—¶ä»åº”è¿è¡Œçš„å¯å»¶è¿Ÿå¼‚æ­¥ä»»åŠ¡ã€‚

å¬å¬è¿™ä¸ªä»‹ç»å°±å¾ˆç¥å¥‡äº†ï¼Œåº”ç”¨é€€å‡ºå’Œè®¾å¤‡é‡å¯éƒ½èƒ½è‡ªåŠ¨è¿è¡Œï¼Ÿé€šè¿‡å¹¿æ’­ï¼Ÿé‚£æ•°æ®åˆæ˜¯æ€ä¹ˆä¿å­˜çš„å‘¢ï¼Ÿå¬è¯´è¿˜å¯ä»¥æ‰§è¡Œå‘¨æœŸæ€§å¼‚æ­¥ä»»åŠ¡ï¼Œé¡ºåºé“¾å¼è°ƒç”¨å“¦ï¼æ¥ä¸‹æ¥ä¸€ä¸€è§£å¯†

ä¸€èˆ¬è¿™ä¸ªAPIåº”ç”¨åˆ°ä»€ä¹ˆåœºæ™¯å‘¢ï¼Ÿæƒ³æƒ³ï¼Œå¯é è¿è¡Œï¼Œè¿˜å¯ä»¥å‘¨æœŸå¼‚æ­¥ã€‚ å¯¹äº†ï¼Œå‘é€æ—¥å¿—ã€‚å¯ä»¥é€šè¿‡`WorkManager`è®¾å®šå‘¨æœŸä»»åŠ¡ï¼Œæ¯å¤©æ‰§è¡Œä¸€æ¬¡å‘é€æ—¥å¿—çš„ä»»åŠ¡ã€‚è€Œä¸”èƒ½å¤Ÿä¿è¯ä½ çš„ä»»åŠ¡å¯é è¿è¡Œï¼Œä¸€å®šå¯ä»¥ä¸Šä¼ åˆ°ï¼Œå½“ç„¶ä¹Ÿæ˜¯æ”¯æŒç›‘å¬ä»»åŠ¡ç»“æœç­‰ã€‚ğŸŒ°ï¼š

1ï¼‰**å¯¼å…¥åº“**



```dart
    dependencies {
      def work_version = "2.3.4"
        // Kotlin + coroutines
        implementation "androidx.work:work-runtime-ktx:$work_version"

        // optional - RxJava2 support
        implementation "androidx.work:work-rxjava2:$work_version"

        // optional - GCMNetworkManager support
        implementation "androidx.work:work-gcm:$work_version"
      }

å¤åˆ¶ä»£ç 
```

2ï¼‰ **æ–°å»ºä»»åŠ¡ç±»**ï¼Œç»§æ‰¿`Worker`ï¼Œé‡å†™`doWork`æ–¹æ³•ï¼Œè¿”å›ä»»åŠ¡ç»“æœã€‚



```kotlin
class UploadLogcatWork(appContext: Context, workerParams: WorkerParameters) :
    Worker(appContext, workerParams) {

    override fun doWork(): Result {

        if (isUploadLogcatSuc()) {
            return Result.success()
        } else if (isNeedRetry()){
            return Result.retry()
        }

        return Result.failure()
    }

    fun isUploadLogcatSuc(): Boolean {
        var isSuc: Boolean = false
        return isSuc
    }

    fun isNeedRetry(): Boolean {
        var isSuc: Boolean = false
        return isSuc
    }
}
å¤åˆ¶ä»£ç 
```

3ï¼‰**æœ€åå°±æ˜¯è®¾å®šçº¦æŸ**ï¼ˆæ˜¯å¦éœ€è¦ç½‘ç»œï¼Œæ˜¯å¦æ”¯æŒä½ç”µé‡ï¼Œæ˜¯å¦æ”¯æŒå……ç”µæ‰§è¡Œï¼Œå»¶è¿Ÿç­‰ç­‰ï¼‰ï¼Œæ‰§è¡Œä»»åŠ¡ï¼ˆå•æ¬¡ä»»åŠ¡æˆ–è€…å¾ªç¯å‘¨æœŸä»»åŠ¡ï¼‰



```kotlin
        //è®¾å®šçº¦æŸ
        val constraints =
            Constraints.Builder()
                //ç½‘ç»œé“¾æ¥çš„æ—¶å€™ä½¿ç”¨
                .setRequiredNetworkType(NetworkType.CONNECTED)
                //æ˜¯å¦åœ¨è®¾å¤‡ç©ºé—²çš„æ—¶å€™æ‰§è¡Œ
                .setRequiresDeviceIdle(false)
                //æ˜¯å¦åœ¨ä½ç”µé‡çš„æ—¶å€™æ‰§è¡Œ
                .setRequiresBatteryNotLow(true)
                //æ˜¯å¦åœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™æ‰§è¡Œ
                .setRequiresStorageNotLow(true)
                //æ˜¯å¦æ—¶å……ç”µçš„æ—¶å€™æ‰§è¡Œ
                .setRequiresCharging(true)
                //å»¶è¿Ÿæ‰§è¡Œ
                .setTriggerContentMaxDelay(1000 * 1, TimeUnit.MILLISECONDS)
                .build()

        //è®¾å®šå¾ªç¯ä»»åŠ¡
        val uploadRequest =
            PeriodicWorkRequestBuilder<UploadLogcatWork>(1, TimeUnit.HOURS)
                .setConstraints(constraints)
                .addTag("uploadTag")
                .build()

        //æ‰§è¡Œ
        WorkManager.getInstance(applicationContext).enqueue(uploadRequest)

        //ç›‘å¬æ‰§è¡Œç»“æœ
        WorkManager.getInstance(this)
//            .getWorkInfosByTagLiveData("uploadTag") //é€šè¿‡tagæ‹¿åˆ°work
            .getWorkInfoByIdLiveData(uploadRequest.id) //é€šè¿‡idæ‹¿åˆ°work
            .observe(this, Observer {
                it?.apply {
                    when (this.state) {
                        WorkInfo.State.BLOCKED -> println("BLOCKED")
                        WorkInfo.State.CANCELLED -> println("CANCELLED")
                        WorkInfo.State.RUNNING -> println("RUNNING")
                        WorkInfo.State.ENQUEUED -> println("ENQUEUED")
                        WorkInfo.State.FAILED -> println("FAILED")
                        WorkInfo.State.SUCCEEDED -> println("SUCCEEDED")
                        else -> println("else status ${this.state}")
                    }
                }

            })
å¤åˆ¶ä»£ç 
```

4ï¼‰**å¦å¤–è¿˜æ”¯æŒä»»åŠ¡å–æ¶ˆï¼Œä»»åŠ¡é“¾å¼é¡ºåºè°ƒç”¨ç­‰**



```kotlin
    //å–æ¶ˆ
    fun cancelWork(){
  WorkManager.getInstance(applicationContext).cancelAllWorkByTag("uploadTag")
    }

    fun startLineWork(){
        //å›¾ç‰‡æ»¤é•œ1
        val filter1 = OneTimeWorkRequestBuilder<UploadLogcatWork>()
            .build()
        //å›¾ç‰‡æ»¤é•œ2
        val filter2 = OneTimeWorkRequestBuilder<UploadLogcatWork>()
            .build()
        //å›¾ç‰‡å‹ç¼©
        val compress = OneTimeWorkRequestBuilder<UploadLogcatWork>()
            .build()
        //å›¾ç‰‡ä¸Šä¼ 
        val upload = OneTimeWorkRequestBuilder<UploadLogcatWork>()
            .build()

        WorkManager.getInstance(applicationContext)
            .beginWith(listOf(filter1, filter2))
            .then(compress)
            .then(upload)
            .enqueue()
    }

å¤åˆ¶ä»£ç 
```

[å®˜æ–¹æ–‡æ¡£](https://links.jianshu.com/go?to=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Farchitecture%2Fworkmanager)
[Demoä»£ç åœ°å€](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJiMuzz%2Fjimu-Jetpack-Demo%2Ftree%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fpanda%2Fjetpackdemo%2Fworkmanager)

### æ€»ç»“

æˆ‘æ„è¯†åˆ°æœ‰å¾ˆå¤šç»éªŒå’ŒçŸ¥è¯†å€¼å¾—åˆ†äº«ç»™å¤§å®¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æˆ‘ä»¬çš„èƒ½åŠ›å’Œç»éªŒè§£ç­”å¤§å®¶åœ¨ITå­¦ä¹ ä¸­çš„å¾ˆå¤šå›°æƒ‘ï¼Œæ‰€ä»¥åœ¨å·¥ä½œç¹å¿™çš„æƒ…å†µä¸‹è¿˜æ˜¯åšæŒå„ç§æ•´ç†å’Œåˆ†äº«ã€‚ä½†è‹¦äºçŸ¥è¯†ä¼ æ’­é€”å¾„æœ‰é™ï¼Œå¾ˆå¤šç¨‹åºå‘˜æœ‹å‹æ— æ³•è·å¾—æ­£ç¡®çš„èµ„æ–™å¾—åˆ°å­¦ä¹ æå‡ï¼Œæ•…æ­¤å°†å¹¶å°†é‡è¦çš„Androidè¿›é˜¶èµ„æ–™åŒ…æ‹¬è‡ªå®šä¹‰viewã€æ€§èƒ½ä¼˜åŒ–ã€MVCä¸MVPä¸MVVMä¸‰å¤§æ¡†æ¶çš„åŒºåˆ«ã€NDKæŠ€æœ¯ã€é˜¿é‡Œé¢è¯•é¢˜ç²¾ç¼–æ±‡æ€»ã€å¸¸è§æºç åˆ†æç­‰å­¦ä¹ èµ„æ–™å…è´¹åˆ†äº«å‡ºæ¥ã€‚

![img](https:////upload-images.jianshu.io/upload_images/19956127-4d1b5e857c4b3c2c.png?imageMogr2/auto-orient/strip|imageView2/2/w/638)

çŸ¥è¯†ä¸ä½“ç³»ï¼Ÿè¿™é‡Œè¿˜æœ‰æ•´ç†å‡ºæ¥çš„Androidè¿›é˜¶å­¦ä¹ çš„æ€ç»´è„‘å›¾ï¼Œç»™å¤§å®¶å‚è€ƒä¸€ä¸ªæ–¹å‘ã€‚åŒ…å«çŸ¥è¯†è„‰ç»œ + è¯¸å¤šç»†èŠ‚ï¼Œç”±äºç¯‡å¹…æœ‰é™ï¼Œä¸‹é¢åªæ˜¯ä»¥å›¾ç‰‡çš„å½¢å¼ç»™å¤§å®¶å±•ç¤ºä¸€éƒ¨åˆ†ã€‚

![img](https:////upload-images.jianshu.io/upload_images/19956127-1b214e26967dacc6.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/1200)

ã€[Androidå­¦ä¹ PDF+å­¦ä¹ è§†é¢‘+é¢è¯•æ–‡æ¡£+çŸ¥è¯†ç‚¹ç¬”è®°](https://links.jianshu.com/go?to=https%3A%2F%2Fshimo.im%2Fdocs%2FjCGWWWkjRwvJWWvg%2F)ã€‘

**ã€Androidé«˜çº§æ¶æ„è§†é¢‘å­¦ä¹ èµ„æºã€‘**

**Androidéƒ¨åˆ†ç²¾è®²è§†é¢‘é¢†å–å­¦ä¹ åæ›´åŠ æ˜¯å¦‚è™æ·»ç¿¼ï¼**è¿›å†›BATJå¤§å‚ç­‰ï¼ˆå¤‡æˆ˜ï¼‰ï¼ç°åœ¨éƒ½è¯´äº’è”ç½‘å¯’å†¬ï¼Œå…¶å®æ— éå°±æ˜¯ä½ ä¸Šé”™äº†è½¦ï¼Œä¸”ç©¿çš„å°‘ï¼ˆæŠ€èƒ½ï¼‰ï¼Œè¦æ˜¯ä½ ä¸Šå¯¹è½¦ï¼Œè‡ªèº«æŠ€æœ¯èƒ½åŠ›å¤Ÿå¼ºï¼Œå…¬å¸æ¢æ‰çš„ä»£ä»·å¤§ï¼Œæ€ä¹ˆå¯èƒ½ä¼šè¢«è£æ‰ï¼Œéƒ½æ˜¯æ·˜æ±°æœ«ç«¯çš„ä¸šåŠ¡Curdè€Œå·²ï¼ç°å¦‚ä»Šå¸‚åœºä¸Šåˆçº§ç¨‹åºå‘˜æ³›æ»¥ï¼Œè¿™å¥—æ•™ç¨‹é’ˆå¯¹Androidå¼€å‘å·¥ç¨‹å¸ˆ1-6å¹´çš„äººå‘˜ã€æ­£å¤„äºç“¶é¢ˆæœŸï¼Œæƒ³è¦å¹´åçªç ´è‡ªå·±æ¶¨è–ªçš„ï¼Œè¿›é˜¶Androidä¸­é«˜çº§ã€æ¶æ„å¸ˆå¯¹ä½ æ›´æ˜¯å¦‚é±¼å¾—æ°´ï¼Œèµ¶å¿«é¢†å–å§ï¼

**ã€Androidè¿›é˜¶å­¦ä¹ è§†é¢‘ã€‘ã€ã€å…¨å¥—Androidé¢è¯•ç§˜ç±ã€‘å¯ä»¥ç®€ä¿¡æˆ‘ã€å­¦ä¹ ã€‘æŸ¥çœ‹å…è´¹é¢†å–æ–¹å¼ï¼**



ä½œè€…ï¼šæœ¨æœ¨ç©Android
é“¾æ¥ï¼šhttps://www.jianshu.com/p/5fb55b20bcfd
æ¥æºï¼šç®€ä¹¦
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚