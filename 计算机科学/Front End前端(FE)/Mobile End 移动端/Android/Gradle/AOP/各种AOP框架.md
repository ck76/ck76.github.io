![aop框架对比](http://r.photo.store.qq.com/psb?/V14L47VC0w3vOf/Y1qdwsNEtv6Z3flJEVV7NA8ySMMUUK8FgcQeTO6V2x8!/r/dDIBAAAAAAAA)



-----



| 方法          | 作用时机                                | 操作对象                    | 优点                                                         | 缺点                                                         | 为了上手，我需要掌握什么？                                   |
| ------------- | --------------------------------------- | --------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| APT           | 编译期：还未编译为 class 时             | .java 文件                  | 1. 可以织入所有类；2. 编译期代理，减少运行时消耗             | 1. 需要使用 apt 编译器编译；2. 需要手动拼接代理的代码（可以使用 Javapoet 弥补）；3. 生成大量代理类 | 设计模式和解耦思想的灵活应用                                 |
| AspectJ       | 编译期、加载时                          | .java 文件                  | 功能强大，除了 hook 之外，还可以为目标类添加变量，接口。也有抽象，继承等各种更高级的玩法。 | 1. 不够轻量级；2. 定义的切点依赖编程语言，无法兼容Lambda语法；3. 无法织入第三方库；4. 会有一些兼容性问题，如：D8、Gradle 4.x等 | 复杂的语法，但掌握几个简单的，就能实现绝大多数场景           |
| **Javassist** | 编译期：class 还未编译为 dex 时或运行时 | class 字节码                | 1. 减少了生成子类的开销；2. 直接操作修改编译后的字节码，直接绕过了java编译器，所以可以做很多突破限制的事情，例如，跨 dex 引用，解决热修复中 CLASS_ISPREVERIFIED 问题。 | 运行时加入切面逻辑，产生性能开销。                           | 1. 自定义 Gradle 插件；2. 掌握groovy 语言                    |
| ASM           | 编译期或运行期字节码注入                | class 字节码                | 小巧轻便、性能好，效率比Javassist高                          | 学习成本高                                                   | 需要熟悉字节码语法，ASM 通过树这种数据结构来表示复杂的字节码结构，并利用 Push 模型来对树进行遍历，在遍历过程中对字节码进行修改。 |
| **ASMDEX**    | 编译期和加载时：转化为 .dex 后          | Dex 字节码，创建 class 文件 | 可以植入所有类                                               | 学习成本高                                                   | 需要对 class 文件比较熟悉，编写过程复杂。                    |
| DexMaker      | 同ASMDEX                                | Dex 字节码，创建 dex 文件   | 同ASMDEX                                                     | 同ASMDEX                                                     | 同ASMDEX                                                     |
| **Cglib**     | 运行期生成子类拦截方法                  | 字节码                      | 没有接口也可以织入                                           | 1. 不能代理被final字段修饰的方法；2. 需要和 dexmaker 结合使用 | --                                                           |
| xposed        | 运行期hook                              | --                          | 能hook自己应用进程的方法，能hook其他应用的方法，能hook系统的方法 | 依赖三方包的支持，兼容性差，手机需要root                     | --                                                           |
| **dexposed**  | 运行期hook                              | --                          | 只能hook自己应用进程的方法，但无需root                       | 1. 依赖三方包的支持，兼容性差；2. 只能支持 Dalvik 虚拟机     | --                                                           |
| epic          | 运行期hook                              | --                          | 支持 Dalvik 和 Art 虚拟机                                    | 只适合在开发调试中使用，碎片化严重有兼容性问题               | --                                                           |

- **Gradle Plugin、Transform等也是.class -> .dex中织入的**